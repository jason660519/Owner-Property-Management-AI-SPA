#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ“‹ é©—è­‰æäº¤è¨Šæ¯æ ¼å¼..."

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Conventional Commits æ ¼å¼é©—è­‰
# æ ¼å¼: [å¯é¸AIåç¨±] type(scope): subject
# æ”¯æ´å¯é¸çš„ [AIåç¨±] å‰ç¶´ï¼Œè®“ AI å”ä½œè€…çš„ commit ä¹Ÿèƒ½é€šéé©—è­‰
PATTERN="^(\[.+\] )?(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,100}$"

if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
  echo ""
  echo "âŒ æäº¤è¨Šæ¯æ ¼å¼éŒ¯èª¤ï¼"
  echo ""
  echo "æ­£ç¢ºæ ¼å¼: [å¯é¸AIåç¨±] <type>(<scope>): <subject>"
  echo ""
  echo "å¯ç”¨çš„ type é¡å‹ï¼š"
  echo "  feat     - æ–°åŠŸèƒ½"
  echo "  fix      - éŒ¯èª¤ä¿®å¾©"
  echo "  docs     - æ–‡ä»¶è®Šæ›´"
  echo "  style    - ç¨‹å¼ç¢¼æ ¼å¼ (ä¸å½±éŸ¿åŠŸèƒ½)"
  echo "  refactor - ç¨‹å¼ç¢¼é‡æ§‹"
  echo "  test     - æ¸¬è©¦ç›¸é—œ"
  echo "  chore    - é›œé …/å»ºç½®å·¥å…·"
  echo "  perf     - æ•ˆèƒ½å„ªåŒ–"
  echo "  ci       - CI/CD è¨­å®š"
  echo "  build    - å»ºç½®ç³»çµ±"
  echo "  revert   - é‚„åŸæäº¤"
  echo ""
  echo "ç¯„ä¾‹ï¼š"
  echo "  feat(auth): æ–°å¢ Google ç™»å…¥åŠŸèƒ½"
  echo "  [Claude] fix(property): ä¿®å¾©æˆ¿æºæœå°‹éŒ¯èª¤"
  echo "  [Gemini] docs: æ›´æ–° API æ–‡ä»¶"
  echo ""
  exit 1
fi

echo "âœ… æäº¤è¨Šæ¯æ ¼å¼æ­£ç¢ºï¼"
