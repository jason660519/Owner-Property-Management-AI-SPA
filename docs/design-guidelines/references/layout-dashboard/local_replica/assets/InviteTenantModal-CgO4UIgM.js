import{r as b,j as e,a4 as M,k as T,F as m,af as O,a9 as B,ai as V,as as y,B as I,P as t,v as D,s as P,aC as H,w as k,J as W,ab as J}from"./TownhouseColor--VjQBVqd.js";import{_ as Q}from"./addTenant-C28JX-tw.js";import{l as u,n as w,v as C,o as _,c1 as Y,h as G,b7 as K,p as S,cV as U,b8 as X,b6 as Z,c as $,cW as ee,bY as ae,cX as te,aP as E}from"./main-dumNSXg9.js";const ne="jEcog",se="_9mHJA",oe="BnSzP",ie="k5PT0",le="tAiBT",re="VkhsZ",ce="mVNK9",me="-qHU-",a={inviteTenantForm:ne,row:se,emailRow:oe,nameDetails:ie,checkboxWrapper:le,contactInfo:re,actions:ce,contactError:me},de=c=>{const s=c?.email,l=c?.telephone;if((!s||s.trim()==="")&&(!l||l.trim()===""))return"Please provide at least one form of contact information"},R=({onSubmit:c,requireEmail:s,leaseId:l,leases:d})=>{const r=b.useMemo(()=>{const o=d?.filter(i=>!i.is_autopilot)?.map(i=>({label:i.title,value:i.id}))||[];return o.unshift({label:"Select a lease",value:""}),o},[d]);return e.jsx(M,{onSubmit:c,subscription:{submitting:!0,values:!0},initialValues:{lease_id:l,invite_to_tenant_portal:!0},keepDirtyOnReinitialize:!0,validate:s?void 0:de,children:({handleSubmit:p,submitting:o,form:i})=>e.jsxs("form",{onSubmit:p,className:a.inviteTenantForm,children:[e.jsxs("div",{className:T(a.row,a.nameDetails),children:[e.jsx(m,{label:"First Name",component:w,name:"first_name",id:"first_name",className:a.name,validate:u(_,C),inputProps:{"data-qa":"first-name",autoFocus:!0}}),e.jsx(m,{label:"Last Name",component:w,name:"last_name",id:"last_name",className:a.name,validate:u(_,C),inputProps:{"data-qa":"last-name"}})]}),!l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:a.row,children:e.jsx(m,{label:"Lease",component:Y,name:"lease_id",disabled:r.length===1,id:"lease_id",validate:u(_),options:r})}),r.length===1&&e.jsx(G,{className:"mb-16",type:"warning",header:e.jsxs("span",{children:["Please"," ",e.jsx(O,{to:"/owners/leases/create",children:"create a lease"})," ","before adding a tenant."]})})]}),!s&&e.jsx(B,{weight:"bold",size:"large",className:a.contactInfo,children:"Provide at least one form of contact information:"}),!s&&e.jsx(V,{subscription:{values:!0,errors:!0,submitFailed:!0},children:({values:h,submitFailed:v})=>{const x=h?.email,f=h?.telephone;return v&&(!x||x.trim()==="")&&(!f||f.trim()==="")?e.jsx("div",{className:a.contactError,children:"Please provide at least one form of contact information"}):null}}),e.jsxs("div",{className:T(a.row,a.emailRow),children:[e.jsx(m,{label:"Email",component:w,type:"email",name:"email",id:"email",className:a.email,validate:s?u(_,S):S,inputProps:{"data-qa":"email"},parse:K}),e.jsx(U,{fieldName:"email",form:i,className:"mb-16"})]}),e.jsx("div",{className:a.row,children:e.jsx(m,{label:"Phone",component:X,name:"telephone",id:"telephone",className:a.phone,hint:s?"(Optional)":void 0,inputProps:{"data-qa":"phone"},validate:u(Z)})}),e.jsx("div",{className:a.checkboxWrapper,children:e.jsx(m,{component:$,type:"checkbox",label:e.jsxs(e.Fragment,{children:[e.jsx(y,{size:"large",weight:"bold",children:"Send invitation to tenant portal"}),e.jsx("br",{}),e.jsx(y,{size:"normal",children:"You can always invite them later."})]}),name:"invite_to_tenant_portal",className:a.checkbox,defaultValue:!0})}),e.jsx("div",{className:a.actions,children:e.jsx(I,{disabled:o,loading:o,htmlType:"submit",id:"add_to_lease","data-qa":"add-tenant-button",children:"Add Tenant"})})]})})};R.propTypes={onSubmit:t.func.isRequired,requireEmail:t.bool,leaseId:t.string,leases:t.array};const pe=({requireEmail:c,leaseId:s,children:l,onSubmit:d,trackEvent:r,trackEventParams:p,trackEventOnSubmit:o,trackEventOnSubmitParams:i,persistTenant:h=!0,refetchQueries:v=[]})=>{const[x]=D(Q),[f,j]=b.useState(!1),{leases:L,loading:q}=ee(),N=b.useCallback(()=>{r&&P(r,p??{}),j(!0)},[r,p]),z=b.useCallback(()=>{j(!1)},[]),A=b.useCallback(async n=>{let g="email";n.email&&n.telephone?g="both":n.telephone&&(g="text"),o&&P(o,i??{});try{h&&(await x({variables:{lease_id:n.lease_id,invite_to_tenant_portal:n.invite_to_tenant_portal,tenant:{first_name:n.first_name,last_name:n.last_name,invite_type:g,email:n.email,telephone:n.telephone?ae(n.telephone):void 0}},refetchQueries:v}),H("Tenant added to the lease!")),j(!1),await d?.(n)}catch(F){te(F,{471:()=>{k(F.message)},default:()=>{k("Error inviting tenant")}})}},[d,o,i,h]);return e.jsxs(e.Fragment,{children:[l?W.cloneElement(l,{onClick:N}):e.jsx(I,{variant:"primary",onClick:N,children:"Add Tenant"}),e.jsx(E,{size:"small",open:f,onClose:z,showCloseIcon:!0,mobileFullScreen:!0,id:"invite-tenant-modal",loading:q,children:e.jsxs(E.Content,{noHeader:!0,noFooter:!0,children:[e.jsx(J,{children:"Add a new tenant"}),e.jsx(R,{requireEmail:c,leaseId:s,leases:L,onSubmit:A})]})})]})};pe.propTypes={requireEmail:t.bool,leaseId:t.string,children:t.node,onSubmit:t.func,trackEvent:t.string,trackEventParams:t.object,trackEventOnSubmit:t.string,trackEventOnSubmitParams:t.object,refetchQueries:t.array,persistTenant:t.bool};export{pe as I};
//# sourceMappingURL=InviteTenantModal-CgO4UIgM.js.map
