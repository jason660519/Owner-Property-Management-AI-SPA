import{j as e,k as S,ab as K,a9 as W,as as Y,Q as J,u as R,L as E,P as n,p as Z,t as ee,K as ne,q as ae,o as te,G as f,U as N,w as T}from"./TownhouseColor--VjQBVqd.js";import{aM as ie,bO as se,dl as ce,el as O,t as oe,dw as de,X as re,br as le,dP as ue,em as me,ar as ke,cX as pe,dR as ge}from"./main-dumNSXg9.js";import{E as be}from"./ExclamationRedFilled-Bzga-kKQ.js";import{C as Ae}from"./ConfirmBankNicknameModalWrapped-DyiU_dJq.js";const he=`query stripeExternalAccount($id: ID!) {
  node(id: $id) {
    id
    ... on StripeExternalAccount {
      nickname
      bank_name
      last4
      status
      default_for_currency
      stripe_identity_id
      deleted
    }
  }
}
`,C={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"stripeExternalAccount"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StripeExternalAccount"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nickname"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bank_name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"last4"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"default_for_currency"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"stripe_identity_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"deleted"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:272,source:{name:"GraphQL request",locationOffset:{line:1,column:1},body:he}}},ye="tn8zD",ve="Xo4cz",fe="_2Vx9S",Ne="cA2Q7",Be="rk1g9",xe="Ope2E",Ie="pFvrX",o={container:ye,title:ve,bankName:fe,hideOnMobile:Ne,options:Be,changingBankAccount:xe,oneOption:Ie},_e=({onPlaidSuccess:m,onAddBankManually:d,className:r,withTitle:k,stripeExternalAccountToReplace:i,segmentTrackingLocation:p})=>{const l=i?.status,c=i?.bank_name,s=i?.nickname,a=i?.last4,t=l==="ERRORED"?"danger":"info",h=l==="ERRORED"?be:ce;return e.jsxs(ie,{className:S(o.container,r),children:[!!i&&e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mb-16",children:"Change bank account"}),e.jsx(se,{icon:h,type:t,containerClassName:"mb-16",children:e.jsx("div",{children:e.jsxs(W,{children:[e.jsx(Y,{className:o.bankName,weight:"bold",children:s??c})," ",e.jsx("span",{className:o.hideOnMobile,children:"â€“"})," Checking account ending in ",a]})})})]}),!i&&k&&e.jsx("h2",{className:o.title,children:"Connect a bank account"}),e.jsx("div",{className:S(o.options,{[o.oneOption]:!d,[o.changingBankAccount]:!!i}),children:e.jsx(O,{segmentTrackingLocation:p,children:e.jsx(O.AllOptions,{onPlaidSuccess:m,onAddBankManually:d})})})]})},F=({className:m,loading:d,onAddBankManually:r,withTitle:k,match:i,onSuccess:p,segmentTrackingLocation:l})=>{const c=i?.params?.bankAccountIDToReplace,{data:s,loading:a}=R(C,{variables:{id:decodeURIComponent(c)},skip:!c}),t=s?.node;return e.jsx(E,{loading:d||a,children:e.jsx(_e,{onPlaidSuccess:p,onAddBankManually:r,stripeExternalAccountToReplace:t,className:m,withTitle:k,segmentTrackingLocation:l})})};F.propTypes={className:n.string,loading:n.bool,onAddBankManually:n.func,withTitle:n.bool,match:n.object,onSuccess:n.func,segmentTrackingLocation:n.string};const je=J(F),Se=({entityId:m,hideBackButton:d,goBackToLink:r,withTitle:k,onAddBankManually:i,refetchQueries:p,className:l,setAsDefaultPaymentMethod:c})=>{const s=Z(),a=ee(),{bankAccountIDToReplace:t}=ne(),{entityId:h}=ae.parse(a.search),{data:P,loading:D}=R(C,{variables:{id:decodeURIComponent(t)},skip:!t}),{user:w,loading:L}=oe(),[M]=de(re),B=le(),{PRIVATE_BASE_PATH:x}=te(),y=f(a,"state.leaseId",""),v=!!t&&P?.node?.stripe_identity_id||m||f(a,"state.entityId",null)||h,I=f(a,"state.redirectTo","");delete a?.state?.leaseId,delete a?.state?.redirectTo,delete a?.state?.accountToBeReplaced;const[_,{loading:$}]=ue({refetchQueries:p}),[Q,{loading:U}]=me(),u=(()=>{if(r)return r;if(I)return I;if(y)return`${x}leases/view/${y}/payments`})(),q=()=>{if(i){i();return}const g=`${x}payments`;let b=`${g}/bank-account/add-bank-info-manually`;t&&(b=`${g}/bank-account/replace-bank-info-manually/${t}`),s(b,{state:{...a.state,entityId:v,leaseId:y,redirectTo:u}})},V=async(g,b)=>{try{const{account_id:A}=b;if(!w?.premium_subscription_subscribed){await _({variables:{entityId:v,plaidPublicToken:g,plaidAccountId:A,setAsDefaultPaymentMethod:c}}),N("Bank account added!"),u?s(u,{state:a?.state}):s(-1);return}const G=await(t?Q:_)({variables:{entityId:v,plaidPublicToken:g,plaidAccountId:A,...t&&{existingBankAccountId:decodeURIComponent(t)},...c&&{setAsDefaultPaymentMethod:c}}}),{id:X,bank_name:z}=G.data[t?"replaceBankAccount":"addBankAccount"].externalAccount;t?N("Bank account changed!"):N("Bank account added!"),B(H=>e.jsx(Ae,{open:!0,initialValues:{id:X,nickname:z},onNicknameUpdated:()=>{H(),u?s(u,{state:a?.state}):s(-1)}}))}catch(A){pe(A,{804:async()=>{await M(),B(j=>e.jsx(ge,{onClose:j}))},807:()=>{T("You cannot add this bank account. Please contact support.")},default:()=>{T("An error has occurred")}})}};return L||D?e.jsx(E,{loading:!0}):e.jsxs(e.Fragment,{children:[!d&&e.jsx(ke,{to:u}),e.jsx(je,{className:l,loading:$||U,onSuccess:V,onAddBankManually:q,withTitle:k,segmentTrackingLocation:"Add bank step - settings"})]})};Se.propTypes={className:n.string,entityId:n.string,hideBackButton:n.bool,withTitle:n.bool,goBackToLink:n.string,onAddBankManually:n.func,refetchQueries:n.arrayOf(n.object),setAsDefaultPaymentMethod:n.bool};export{Se as default};
//# sourceMappingURL=ManageBankAccount-CanCiq3t.js.map
