import{r as ye,j as I,P as g,bt as G,J as u,bu as q,ah as ee,bv as A,au as o,h as ve,bw as _e,bx as le,s as y,a5 as Re,K as Oe,p as Ae}from"./TownhouseColor--VjQBVqd.js";import{ir as a,t as Pe,is as Ee,cb as Ue,q as Ne,it as _,bo as De,bJ as ke,cv as ce}from"./main-dumNSXg9.js";import{g as je,a as Ge,s as We,b as Ye,c as Be,C as P,A as m,T as c,d as Fe,e as He,f as $e,h as Ve,i as ze,j as Ze,k as N,l as Ke,m as W,n as Je,t as v,G as E,o as f,p as b,q as fe,r as be,u as Te,v as te,U as Y,w as Se,x as xe,y as B,z as F,B as H,D as $,M as V,E as z,F as Z,H as K,I as J,J as Q,K as L,L as w,N as D,O as he,S as k,P as j,Q as T,R as Qe,V as Xe,W as Le,X as qe,Y as de,Z as et,_ as tt,$ as st}from"./index-56dI0Kdm.js";import{i as it}from"./isLoggedInRenter-DW316R4Q.js";import"./AddNewLeadModal-Crz9YkrQ.js";import"./detailed_lead.fragment-DkOpsOoq.js";import"./Tenants-YQpcizTs.js";import"./useChatArchive-Cd6Myl8B.js";import"./Block-Bmvgl2yE.js";import"./BackArrow-DmJUErXj.js";import"./MessagesLoadingAnimation-Clib0gcD.js";import"./messagesLoading.animation-CJfAGeUN.js";const se=l=>I.jsxs("svg",{...l,viewBox:"0 0 24 24",fill:l.color,fillRule:"evenodd",xmlns:"http://www.w3.org/2000/svg",children:[I.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.8999 3.92327C1.8999 3.5919 2.16853 3.32327 2.4999 3.32327H11.4999C11.8313 3.32327 12.0999 3.5919 12.0999 3.92327C12.0999 4.25464 11.8313 4.52327 11.4999 4.52327H3.0999V20.6862H17.6092V13.4996C17.6092 13.1683 17.8778 12.8996 18.2092 12.8996C18.5406 12.8996 18.8092 13.1683 18.8092 13.4996V21.2862C18.8092 21.6176 18.5406 21.8862 18.2092 21.8862H2.4999C2.16853 21.8862 1.8999 21.6176 1.8999 21.2862V3.92327Z",fill:l.color}),I.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.3514 7.84802C16.5857 8.08233 16.5857 8.46223 16.3514 8.69655L8.8192 16.2288C8.58488 16.4631 8.20498 16.4631 7.97067 16.2288C7.73635 15.9944 7.73635 15.6145 7.97067 15.3802L15.5029 7.84802C15.7372 7.6137 16.1171 7.6137 16.3514 7.84802Z",fill:l.color}),I.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.0849 2.83306L21.4999 2.69962L21.4156 2.10557C21.6111 2.07781 21.8078 2.14805 21.9415 2.29338C22.0752 2.43871 22.1288 2.64053 22.0849 2.83306ZM17.9891 11.1434C19.4431 9.68909 20.4634 7.58935 21.115 5.90268C21.444 5.05094 21.6856 4.28717 21.845 3.73575C21.9249 3.45979 21.9843 3.23634 22.024 3.08087C22.0439 3.00312 22.0589 2.94231 22.069 2.90038L22.0805 2.85186L22.0836 2.83866L22.0849 2.83306C22.0849 2.83306 22.0849 2.83306 21.4999 2.69962C21.4156 2.10557 21.4156 2.10557 21.4156 2.10557L21.4124 2.10603L21.4053 2.10706L21.3798 2.11085C21.3578 2.11417 21.326 2.11906 21.2851 2.12561C21.2033 2.13871 21.0851 2.15844 20.936 2.18545C20.638 2.23943 20.2162 2.3226 19.7163 2.44004C18.7198 2.67413 17.398 3.04786 16.1249 3.60514C15.9482 3.68244 15.8195 3.8399 15.7789 4.02835L15.7781 4.03208L15.7736 4.05149C15.7694 4.06951 15.7627 4.0974 15.7535 4.13373C15.7349 4.2065 15.7062 4.31252 15.6667 4.44057C15.5872 4.69872 15.4669 5.03654 15.3026 5.36885C15.136 5.70584 14.9387 6.0071 14.7175 6.21718C14.7034 6.23059 14.6893 6.24353 14.6752 6.25599V5.20484C14.6752 4.87347 14.4066 4.60484 14.0752 4.60484C13.9939 4.60484 13.9164 4.621 13.8457 4.65027C13.7589 4.67556 13.6804 4.70963 13.6156 4.7412C13.5046 4.79537 13.3891 4.86486 13.2737 4.94298C13.0424 5.09956 12.7815 5.31132 12.5132 5.56234C11.9769 6.06408 11.3777 6.75371 10.8997 7.54285C10.4243 8.32764 10.0452 9.24973 10.0039 10.2066C9.96164 11.1872 10.2773 12.1712 11.1295 13.0211C11.8236 13.7149 12.8789 13.9387 14.0603 13.6484C15.2356 13.3595 16.5766 12.5602 17.9891 11.1434ZM13.4752 6.30918C13.4289 6.35019 13.3814 6.39337 13.333 6.43867C12.8642 6.87717 12.3389 7.48304 11.9261 8.16459C11.5106 8.85048 11.2323 9.57425 11.2028 10.2583C11.1743 10.9185 11.3743 11.5705 11.9771 12.1716C12.3 12.4945 12.8863 12.7012 13.7739 12.483C14.6676 12.2634 15.8235 11.6159 17.1394 10.296C18.4135 9.02188 19.3616 7.11126 19.9956 5.47023C20.2985 4.68611 20.5241 3.97894 20.6762 3.45766C20.4732 3.49915 20.2425 3.5491 19.9908 3.60824C19.1058 3.81614 17.9739 4.13446 16.8733 4.5906C16.8563 4.65145 16.8364 4.71973 16.8135 4.794C16.722 5.09084 16.5798 5.49302 16.3783 5.9007C16.179 6.30371 15.907 6.74243 15.5438 7.08735C15.1747 7.4379 14.6842 7.71476 14.0752 7.71476C13.7438 7.71476 13.4752 7.44613 13.4752 7.11476V6.30918Z",fill:l.color})]});se.defaultProps={color:"#033A6D",width:24,height:24};se.propTypes={width:g.number,height:g.number,color:g.string};const nt=ye.memo(se),ot=(l,e,t)=>{if(!e||!l.length)return l;const s=je(e);if(!s.length)return l;if(it())return Ye()?l.filter(h=>h.conversationWith?.role!=="owner"?!0:!Be(h.conversationWith,s,t)):l;const n=Ge();return n?l.filter(r=>r.conversationWith?.role!=="renter"?!0:!We(r.conversationWith,s,n)):l},at=l=>({display:"flex",listStyleType:"none",padding:"8px",margin:"0",width:"72px",backgroundColor:G,borderRadius:"4px",alignItems:"center",justifyContent:"flex-end",position:"absolute",right:"16px",height:"100%"}),rt=(l,e,t)=>({outline:"0",border:"0",height:"24px",width:"24px",borderRadius:"4px",alignItems:"center",display:"inline-flex",justifyContent:"center",position:"relative",background:`url(${l?e:t}) center center no-repeat`}),lt="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHdpZHRoPScyNHB4JyBoZWlnaHQ9JzI0cHgnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwMCAxMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIiBjbGFzcz0idWlsLXJpbmciPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSJub25lIiBjbGFzcz0iYmsiPjwvcmVjdD48ZGVmcz48ZmlsdGVyIGlkPSJ1aWwtcmluZy1zaGFkb3ciIHg9Ii0xMDAlIiB5PSItMTAwJSIgd2lkdGg9IjMwMCUiIGhlaWdodD0iMzAwJSI+PGZlT2Zmc2V0IHJlc3VsdD0ib2ZmT3V0IiBpbj0iU291cmNlR3JhcGhpYyIgZHg9IjAiIGR5PSIwIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciByZXN1bHQ9ImJsdXJPdXQiIGluPSJvZmZPdXQiIHN0ZERldmlhdGlvbj0iMCI+PC9mZUdhdXNzaWFuQmx1cj48ZmVCbGVuZCBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJibHVyT3V0IiBtb2RlPSJub3JtYWwiPjwvZmVCbGVuZD48L2ZpbHRlcj48L2RlZnM+PHBhdGggZD0iTTEwLDUwYzAsMCwwLDAuNSwwLjEsMS40YzAsMC41LDAuMSwxLDAuMiwxLjdjMCwwLjMsMC4xLDAuNywwLjEsMS4xYzAuMSwwLjQsMC4xLDAuOCwwLjIsMS4yYzAuMiwwLjgsMC4zLDEuOCwwLjUsMi44IGMwLjMsMSwwLjYsMi4xLDAuOSwzLjJjMC4zLDEuMSwwLjksMi4zLDEuNCwzLjVjMC41LDEuMiwxLjIsMi40LDEuOCwzLjdjMC4zLDAuNiwwLjgsMS4yLDEuMiwxLjljMC40LDAuNiwwLjgsMS4zLDEuMywxLjkgYzEsMS4yLDEuOSwyLjYsMy4xLDMuN2MyLjIsMi41LDUsNC43LDcuOSw2LjdjMywyLDYuNSwzLjQsMTAuMSw0LjZjMy42LDEuMSw3LjUsMS41LDExLjIsMS42YzQtMC4xLDcuNy0wLjYsMTEuMy0xLjYgYzMuNi0xLjIsNy0yLjYsMTAtNC42YzMtMiw1LjgtNC4yLDcuOS02LjdjMS4yLTEuMiwyLjEtMi41LDMuMS0zLjdjMC41LTAuNiwwLjktMS4zLDEuMy0xLjljMC40LTAuNiwwLjgtMS4zLDEuMi0xLjkgYzAuNi0xLjMsMS4zLTIuNSwxLjgtMy43YzAuNS0xLjIsMS0yLjQsMS40LTMuNWMwLjMtMS4xLDAuNi0yLjIsMC45LTMuMmMwLjItMSwwLjQtMS45LDAuNS0yLjhjMC4xLTAuNCwwLjEtMC44LDAuMi0xLjIgYzAtMC40LDAuMS0wLjcsMC4xLTEuMWMwLjEtMC43LDAuMS0xLjIsMC4yLTEuN0M5MCw1MC41LDkwLDUwLDkwLDUwczAsMC41LDAsMS40YzAsMC41LDAsMSwwLDEuN2MwLDAuMywwLDAuNywwLDEuMSBjMCwwLjQtMC4xLDAuOC0wLjEsMS4yYy0wLjEsMC45LTAuMiwxLjgtMC40LDIuOGMtMC4yLDEtMC41LDIuMS0wLjcsMy4zYy0wLjMsMS4yLTAuOCwyLjQtMS4yLDMuN2MtMC4yLDAuNy0wLjUsMS4zLTAuOCwxLjkgYy0wLjMsMC43LTAuNiwxLjMtMC45LDJjLTAuMywwLjctMC43LDEuMy0xLjEsMmMtMC40LDAuNy0wLjcsMS40LTEuMiwyYy0xLDEuMy0xLjksMi43LTMuMSw0Yy0yLjIsMi43LTUsNS04LjEsNy4xIGMtMC44LDAuNS0xLjYsMS0yLjQsMS41Yy0wLjgsMC41LTEuNywwLjktMi42LDEuM0w2Niw4Ny43bC0xLjQsMC41Yy0wLjksMC4zLTEuOCwwLjctMi44LDFjLTMuOCwxLjEtNy45LDEuNy0xMS44LDEuOEw0Nyw5MC44IGMtMSwwLTItMC4yLTMtMC4zbC0xLjUtMC4ybC0wLjctMC4xTDQxLjEsOTBjLTEtMC4zLTEuOS0wLjUtMi45LTAuN2MtMC45LTAuMy0xLjktMC43LTIuOC0xTDM0LDg3LjdsLTEuMy0wLjYgYy0wLjktMC40LTEuOC0wLjgtMi42LTEuM2MtMC44LTAuNS0xLjYtMS0yLjQtMS41Yy0zLjEtMi4xLTUuOS00LjUtOC4xLTcuMWMtMS4yLTEuMi0yLjEtMi43LTMuMS00Yy0wLjUtMC42LTAuOC0xLjQtMS4yLTIgYy0wLjQtMC43LTAuOC0xLjMtMS4xLTJjLTAuMy0wLjctMC42LTEuMy0wLjktMmMtMC4zLTAuNy0wLjYtMS4zLTAuOC0xLjljLTAuNC0xLjMtMC45LTIuNS0xLjItMy43Yy0wLjMtMS4yLTAuNS0yLjMtMC43LTMuMyBjLTAuMi0xLTAuMy0yLTAuNC0yLjhjLTAuMS0wLjQtMC4xLTAuOC0wLjEtMS4yYzAtMC40LDAtMC43LDAtMS4xYzAtMC43LDAtMS4yLDAtMS43QzEwLDUwLjUsMTAsNTAsMTAsNTB6IiBmaWxsPSIjZmZmZmZmIiBmaWx0ZXI9InVybCgjdWlsLXJpbmctc2hhZG93KSI+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJyb3RhdGUiIGZyb209IjAgNTAgNTAiIHRvPSIzNjAgNTAgNTAiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBkdXI9IjFzIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9wYXRoPjwvc3ZnPg==",ct="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M17.25%2021H6.75C6.35218%2021%205.97064%2020.842%205.68934%2020.5607C5.40804%2020.2794%205.25%2019.8978%205.25%2019.5V6H18.75V19.5C18.75%2019.8978%2018.592%2020.2794%2018.3107%2020.5607C18.0294%2020.842%2017.6478%2021%2017.25%2021Z'%20stroke='%23FF0000'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9.75%2016.5V10.5'%20stroke='%23FF0000'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.25%2016.5V10.5'%20stroke='%23FF0000'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M2.25%206H21.75'%20stroke='%23FF0000'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.25%203H9.75C9.35218%203%208.97064%203.15804%208.68934%203.43934C8.40804%203.72064%208.25%204.10218%208.25%204.5V6H15.75V4.5C15.75%204.10218%2015.592%203.72064%2015.3107%203.43934C15.0294%203.15804%2014.6478%203%2014.25%203Z'%20stroke='%23FF0000'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e";class ht extends u.PureComponent{static contextType=P;constructor(e){super(e),this._isMounted=!1,this.state={deleteInProgress:!1}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}toggleTooltip=(e,t)=>{const s=e.target;t?s.setAttribute("title",s.dataset.title):s.removeAttribute("title")};deleteConversation=e=>{this.props.actionGenerated(m.DELETE_CONVERSATION,this.props.conversation),e.stopPropagation()};render(){const e=a("li",null,a("button",{type:"button",css:rt(this.state.deleteInProgress,lt,ct),className:"group__button button__delete","data-title":c.translate("DELETE",this.context.language),onMouseEnter:t=>this.toggleTooltip(t,!0),onMouseLeave:t=>this.toggleTooltip(t,!1),onClick:this.deleteConversation}));return a("ul",{css:at(this.context),className:"list__item__actions"},e)}}const dt=l=>{const e=l.selectedConversation&&l.selectedConversation.conversationId===l.conversation.conversationId?{backgroundColor:G}:{};return{display:"flex",flexDirection:"row",justifyContent:"left",alignItems:"center",cursor:"pointer",width:"100%",padding:"8px 16px",position:"relative",borderBottom:`1px solid ${A}`,...e,"&:hover":{backgroundColor:G}}},Ct=()=>({display:"inline-block",width:"40px",height:"40px",flexShrink:"0"}),gt=()=>({width:"calc(100% - 45px)",flexGrow:"1",paddingLeft:"8px",position:"relative",paddingRight:"60px"}),Ce=()=>({display:"flex",justifyContent:"space-between",alignItems:"baseline"}),pt=()=>({fontSize:"14px",fontWeight:"bold",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",lineHeight:"21px",letterSpacing:0,color:ee,fontFamily:"Open Sans"}),ut=()=>({margin:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:ee,fontFamily:"Open Sans",fontSize:"12px",letterSpacing:0,lineHeight:"18px"}),mt=()=>({color:q,fontFamily:"Open Sans",fontSize:"12px",fontWeight:600,letterSpacing:0,lineHeight:"18px"}),Mt=()=>({color:q,fontFamily:"Open Sans",fontSize:"12px",fontWeight:"bold",letterSpacing:0,lineHeight:"18px",textTransform:"capitalize",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),vt=()=>({display:"flex",flexDirection:"column",position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",alignItems:"flex-end"});class ie extends u.PureComponent{static contextType=P;constructor(e){super(e),this.state={lastMessage:"",lastMessageTimestamp:"",enableUnreadCount:!1,isHovering:!1,enableHideDeletedMessages:!1}}componentDidMount(){const e=this.getLastMessage(),t=this.getLastMessageTimestamp();this.enableUnreadCount(),this.enableHideDeletedMessages(),this.setState({lastMessage:e,lastMessageTimestamp:t})}componentDidUpdate(e){const t=JSON.stringify(e.conversation),s=JSON.stringify(this.props.conversation);if(t!==s){const i=this.getLastMessage(),n=this.getLastMessageTimestamp();this.setState({lastMessage:i,lastMessageTimestamp:n})}this.enableUnreadCount(),this.enableHideDeletedMessages()}getLastMessage=()=>{if(this.props.hasOwnProperty("conversation")===!1||this.props.conversation.hasOwnProperty("lastMessage")===!1)return!1;let e=null;const t=this.props.conversation.lastMessage;if(t.hasOwnProperty("deletedAt"))this.state.enableHideDeletedMessages?e="":e=this.props.loggedInUser.uid===t.sender.uid?`${c.translate("YOU_DELETED_THIS_MESSAGE",this.context.language)}`:`${c.translate("THIS_MESSAGE_DELETED",this.context.language)}`;else switch(t.category){case o.CometChat.CATEGORY_MESSAGE:e=this.getMessage(t);break;case o.CometChat.CATEGORY_CALL:e=this.getCallMessage(t);break;case o.CometChat.CATEGORY_ACTION:e=this.getActionMessage(t);break;case o.CometChat.CATEGORY_CUSTOM:e=this.getCustomMessage(t);break}return e};getLastMessageTimestamp=()=>{if(this.props.hasOwnProperty("conversation")===!1||this.props.conversation.hasOwnProperty("lastMessage")===!1||this.props.conversation.lastMessage.hasOwnProperty("sentAt")===!1&&this.props.conversation.lastMessage.hasOwnProperty("_composedAt")===!1)return!1;let e=this.props.conversation.lastMessage._composedAt||this.props.conversation.lastMessage.sentAt;return e=Fe(e,this.context.language),e};getCustomMessage=e=>{let t=null;const s=this.props.loggedInUser.uid!==e.sender.uid?`${e.sender.name}: `:"";switch(e.type){case Ze:{const i=c.translate("CUSTOM_MESSAGE_POLL",this.context.language);t=e.receiverType===o.CometChat.RECEIVER_TYPE.GROUP?`${s} ${i}`:`${i}`}break;case ze:{const i=c.translate("CUSTOM_MESSAGE_STICKER",this.context.language);t=e.receiverType===o.CometChat.RECEIVER_TYPE.GROUP?`${s} ${i}`:`${i}`}break;case Ve:{const i=c.translate("CUSTOM_MESSAGE_DOCUMENT",this.context.language);t=e.receiverType===o.CometChat.RECEIVER_TYPE.GROUP?`${s} ${i}`:`${i}`}break;case $e:{const i=c.translate("CUSTOM_MESSAGE_WHITEBOARD",this.context.language);t=e.receiverType===o.CometChat.RECEIVER_TYPE.GROUP?`${s} ${i}`:`${i}`}break;case He:{const i=c.translate("VIDEO_CALL",this.context.language);t=`${s} ${i}`}break}return t};getTextMessage=e=>{let t=e.text;const s=N(e,"xss-filter");s&&s.hasOwnProperty("sanitized_text")&&(t=s.sanitized_text);const i=N(e,"data-masking");i&&i.hasOwnProperty("data")&&i.data.hasOwnProperty("sensitive_data")&&i.data.hasOwnProperty("message_masked")&&i.data.sensitive_data==="yes"&&(t=i.data.message_masked);const n=N(e,"profanity-filter");return n&&n.hasOwnProperty("profanity")&&n.hasOwnProperty("message_clean")&&n.profanity==="yes"&&(t=n.message_clean),t};getMessage=e=>{let t=null;const s=e?.sender?.uid===this.props?.loggedInUser?.uid?"You":e?.sender?.name;switch(e.type){case o.CometChat.MESSAGE_TYPE.TEXT:{const i=this.getTextMessage(e);t=`${s}: ${i}`}break;case o.CometChat.MESSAGE_TYPE.MEDIA:{const i=c.translate("MEDIA_MESSAGE",this.context.language);t=`${s}: ${i}`}break;case o.CometChat.MESSAGE_TYPE.IMAGE:{const i=c.translate("MESSAGE_IMAGE",this.context.language);t=`${s}: ${i}`}break;case o.CometChat.MESSAGE_TYPE.FILE:{const i=c.translate("MESSAGE_FILE",this.context.language);t=`${s}: ${i}`}break;case o.CometChat.MESSAGE_TYPE.VIDEO:{const i=c.translate("MESSAGE_VIDEO",this.context.language);t=`${s}: ${i}`}break;case o.CometChat.MESSAGE_TYPE.AUDIO:{const i=c.translate("MESSAGE_AUDIO",this.context.language);t=`${s}: ${i}`}break;case o.CometChat.MESSAGE_TYPE.CUSTOM:{const i=c.translate("CUSTOM_MESSAGE",this.context.language);t=`${s}: ${i}`}break}return t};getCallMessage=e=>{let t=null;const s=this.props.loggedInUser.uid!==e.sender.uid?`${e.sender.name}: `:"";switch(e.type){case o.CometChat.MESSAGE_TYPE.VIDEO:{const i=c.translate("VIDEO_CALL",this.context.language);t=e.receiverType===o.CometChat.RECEIVER_TYPE.GROUP?`${s} ${i}`:`${i}`}break;case o.CometChat.MESSAGE_TYPE.AUDIO:{const i=c.translate("AUDIO_CALL",this.context.language);t=e.receiverType===o.CometChat.RECEIVER_TYPE.GROUP?`${s} ${i}`:`${i}`}break}return t};getActionMessage=e=>{let t=null;if(e.hasOwnProperty("actionBy")===!1||e.hasOwnProperty("actionOn")===!1||e.action!==o.CometChat.ACTION_TYPE.MEMBER_JOINED&&e.action!==o.CometChat.ACTION_TYPE.MEMBER_LEFT&&(e.actionBy.hasOwnProperty("name")===!1||e.actionOn.hasOwnProperty("name")===!1))return t;if(e.action===o.CometChat.ACTION_TYPE.MEMBER_SCOPE_CHANGED)if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("extras"))if(e.data.extras.hasOwnProperty("scope")){if(e.data.extras.scope.hasOwnProperty("new")===!1)return t}else return t;else return t;if(e.action===o.CometChat.ACTION_TYPE.MEMBER_SCOPE_CHANGED&&e.data.extras.hasOwnProperty("scope")===!1||e.action===o.CometChat.ACTION_TYPE.MEMBER_SCOPE_CHANGED&&e.data.extras.scope.hasOwnProperty("new")===!1)return t;const s=e.actionBy,i=e.actionOn,n=s.name,r=e.action!==o.CometChat.ACTION_TYPE.MEMBER_JOINED&&e.action!==o.CometChat.ACTION_TYPE.MEMBER_LEFT?i.name:"";switch(e.action){case o.CometChat.ACTION_TYPE.MEMBER_ADDED:t=`${n} ${c.translate("ADDED",this.context.language)} ${r}`;break;case o.CometChat.ACTION_TYPE.MEMBER_JOINED:t=`${n} ${c.translate("JOINED",this.context.language)}`;break;case o.CometChat.ACTION_TYPE.MEMBER_LEFT:t=`${n} ${c.translate("LEFT",this.context.language)}`;break;case o.CometChat.ACTION_TYPE.MEMBER_KICKED:t=`${n} ${c.translate("KICKED",this.context.language)} ${r}`;break;case o.CometChat.ACTION_TYPE.MEMBER_BANNED:t=`${n} ${c.translate("BANNED",this.context.language)} ${r}`;break;case o.CometChat.ACTION_TYPE.MEMBER_UNBANNED:t=`${n} ${c.translate("UNBANNED",this.context.language)} ${r}`;break;case o.CometChat.ACTION_TYPE.MEMBER_SCOPE_CHANGED:{const h=e.data.extras.scope.new;t=`${n} ${c.translate("MADE",this.context.language)} ${r} ${c.translate(h,this.context.language)}`;break}}return t};toggleTooltip=(e,t)=>{const s=e.target,i=s.scrollWidth,n=s.clientWidth;if(i<=n)return!1;t?s.setAttribute("title",s.textContent):s.removeAttribute("title")};enableUnreadCount=()=>{this.context.FeatureRestriction.isUnreadCountEnabled().then(e=>{e!==this.state.enableUnreadCount&&this.setState({enableUnreadCount:e})}).catch(e=>{this.state.enableUnreadCount!==!1&&this.setState({enableUnreadCount:!1})})};enableHideDeletedMessages=()=>{this.context.FeatureRestriction.isHideDeletedMessagesEnabled().then(e=>{e!==this.state.enableHideDeletedMessages&&this.setState({enableHideDeletedMessages:e})}).catch(e=>{this.state.enableHideDeletedMessages!==!1&&this.setState({enableHideDeletedMessages:!1})})};handleMouseHover=e=>{e&&!this.state.isHovering?this.setState({isHovering:!0}):!e&&this.state.isHovering&&this.setState({isHovering:!1})};render(){let e=null;this.state.lastMessage&&(e=a("span",{css:mt(this.props),className:"item__details__timestamp"},this.state.lastMessageTimestamp));let t;if(this.props.conversation.conversationType===o.CometChat.RECEIVER_TYPE.USER){const C=this.props.conversation.conversationWith.status;t=a(Ke,{status:C,borderColor:this.props.theme.borderColor.primary})}let s=null;this.props.conversation.conversationType===o.CometChat.RECEIVER_TYPE.USER?s=a(W,{user:this.props.conversation.conversationWith}):this.props.conversation.conversationType===o.CometChat.RECEIVER_TYPE.GROUP&&(s=a(W,{group:this.props.conversation.conversationWith}));let i=null;this.state.enableUnreadCount&&(i=a(Je,{count:this.props.conversation.unreadMessageCount})),this.state.isHovering&&{...this.props,conversation:this.props.conversation};const n=this.props.loggedInUser?.role==="renter",r=()=>(this.props.conversation?.conversationWith?.metadata||{})[this.props?.loggedInUser?.uid]?.relation,h=()=>(this.props.conversation?.conversationWith?.metadata||{})[this.props?.loggedInUser?.uid]?.address,d=()=>{const C=this.props.conversation?.conversationWith?.uid||"";return(this.props.loggedInUser?.metadata?.[C]||{})?.address},p=()=>{if(this.props.conversation.conversationType===o.CometChat.RECEIVER_TYPE.GROUP){const C=this.props.conversation.conversationWith.membersCount;return`${C} Member${C>1?"s":""}`}return n?d():`${r()}: ${h()}`};return a("div",{css:dt(this.props),className:"list__item",onMouseEnter:()=>this.handleMouseHover(!0),onMouseLeave:()=>this.handleMouseHover(!1),onClick:()=>this.props.handleClick(this.props.conversation)},a("div",{css:Ct(),className:"list__item__thumbnail"},s,t),a("div",{css:gt(),className:"list__item__details",dir:c.getDirection(this.context.language)},a("div",{css:Ce(),className:"item__details_block_one"},a("div",{css:pt(this.props),className:"item__details__name",onMouseEnter:C=>this.toggleTooltip(C,!0),onMouseLeave:C=>this.toggleTooltip(C,!1)},this.props.conversation.conversationWith.name)),a("div",{css:Mt()},p()),a("div",{css:Ce(),className:"item__details_block_two"},a("div",{css:ut(),className:"item__details__last-message",onMouseEnter:C=>this.toggleTooltip(C,!0),onMouseLeave:C=>this.toggleTooltip(C,!1)},this.state.lastMessage)),a("div",{css:vt()},e,i)))}}ie.defaultProps={theme:v,loggedInUser:null,conversation:{conversationWith:{}}};ie.propTypes={theme:g.object,loggedInUser:g.shape(o.CometChat.User),conversation:g.shape(o.CometChat.Conversation)};const Et=l=>({display:"flex",height:"100%",width:"100%",boxSizing:"border-box",position:"relative",fontFamily:`${l.theme.fontFamily}`,border:`1px solid ${l.theme.borderColor.primary}`,"*":{boxSizing:"border-box",fontFamily:`${l.theme.fontFamily}`,"::-webkit-scrollbar":{width:"8px",height:"4px"},"::-webkit-scrollbar-track":{background:"#ffffff00"},"::-webkit-scrollbar-thumb":{background:"#ccc","&:hover":{background:"#aaa"}}}}),ft=(l,e)=>{const t=l.sidebarview?{left:"0",boxShadow:"rgba(0, 0, 0, .4) -30px 0 30px 30px"}:{},s=[...e.theme.breakPoints];return{width:"280px",borderRight:`1px solid ${e.theme.borderColor.primary}`,height:"100%",position:"relative",display:"flex",flexDirection:"column","> .chats":{height:"calc(100% - 5px)"},[`@media ${s[0]}`]:{position:"absolute!important",left:"-100%",top:"0",bottom:"0",width:"100%!important",zIndex:"2",backgroundColor:`${e.theme.backgroundColor.white}`,transition:"all .3s ease-out",...t}}},bt=(l,e)=>{const t=[...e.theme.breakPoints];return{width:"calc(100% - 280px)",height:"100%",order:"2",display:"flex",flexDirection:"row",[`@media ${t[1]}, ${t[2]}`]:{width:"100%"}}};class we extends u.Component{loggedInUser=null;constructor(e){super(e),this.state={tab:"conversations",sidebarview:!1},this.contextProviderRef=u.createRef(),this.chatListRef=u.createRef()}componentDidMount(){this.props.chatWithUser.length===0&&this.props.chatWithGroup.length===0&&this.toggleSideBar()}itemClicked=(e,t)=>{this.contextProviderRef.setTypeAndItem(t,e),this.toggleSideBar()};actionHandler=(e,t,s,...i)=>{switch(e){case m.TOGGLE_SIDEBAR:this.toggleSideBar();break;case b:case f:case E:this.groupUpdated(e,t,s,...i);break}};toggleSideBar=()=>{const e=this.state.sidebarview;this.setState({sidebarview:!e})};groupUpdated=(e,t,s,i)=>{switch(e){case E:case f:{this.contextProviderRef.type===o.CometChat.ACTION_TYPE.TYPE_GROUP&&this.contextProviderRef.item.guid===s.guid&&i.user.uid===this.loggedInUser.uid&&(this.contextProviderRef.setItem({}),this.contextProviderRef.setType(""));break}case b:{if(this.contextProviderRef.type===o.CometChat.ACTION_TYPE.TYPE_GROUP&&this.contextProviderRef.item.guid===s.guid&&i.user.uid===this.loggedInUser.uid){const n=Object.assign({},this.contextProviderRef.item,{scope:i.scope});this.contextProviderRef.setItem(n),this.contextProviderRef.setType(o.CometChat.ACTION_TYPE.TYPE_GROUP)}break}}};render(){let e=a(fe,{theme:this.props.theme,lang:this.props.lang,_parent:"conversations",actionGenerated:this.actionHandler});return a(te,{ref:t=>this.contextProviderRef=t,user:this.props.chatWithUser,group:this.props.chatWithGroup,language:this.props.lang},a("div",{css:Et(this.props),className:"cometchat cometchat--chats",dir:c.getDirection(this.props.lang)},a("div",{css:ft(this.state,this.props),className:"chats__sidebar"},a(X,{ref:t=>this.chatListRef=t,_parent:"clwm",theme:this.props.theme,lang:this.props.lang,onItemClick:this.itemClicked,actionGenerated:this.actionHandler})),a("div",{css:bt(this.state,this.props),className:"chats__main"},e),a(be,{theme:this.props.theme,lang:this.props.lang,actionGenerated:this.actionHandler}),a(Te,{theme:this.props.theme,lang:this.props.lang,actionGenerated:this.actionHandler})))}}we.defaultProps={lang:c.getDefaultLanguage(),theme:v,chatWithUser:"",chatWithGroup:""};we.propTypes={lang:g.string,theme:g.object,chatWithUser:g.string,chatWithGroup:g.string};const Tt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M11.7794%2020L4.15627%2012.3769C4.10673%2012.3274%204.06743%2012.2687%204.04062%2012.204C4.0138%2012.1393%204%2012.07%204%2012C4%2011.93%204.0138%2011.8607%204.04062%2011.796C4.06743%2011.7313%204.10673%2011.6726%204.15627%2011.6231L11.7794%204'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e";class St{conversationRequest=null;conversationListenerId="chatlist_"+new Date().getTime();userListenerId="chatlist_user_"+new Date().getTime();groupListenerId="chatlist_group_"+new Date().getTime();callListenerId="chatlist_call_"+new Date().getTime();constructor(e){const t=e.UIKitSettings.chatListMode,s=Y.chatListFilterOptions;switch(t){case s.USERS:this.conversationRequest=new o.CometChat.ConversationsRequestBuilder().setConversationType(o.CometChat.ACTION_TYPE.TYPE_USER).setLimit(30).withUserAndGroupTags(!0).withTags(!0).build();break;case s.GROUPS:this.conversationRequest=new o.CometChat.ConversationsRequestBuilder().setConversationType(o.CometChat.ACTION_TYPE.TYPE_GROUP).setLimit(30).withUserAndGroupTags(!0).withTags(!0).build();break;default:this.conversationRequest=new o.CometChat.ConversationsRequestBuilder().setLimit(30).withUserAndGroupTags(!0).withTags(!0).build();break}}fetchNextConversation(){return this.conversationRequest.fetchNext()}attachListeners(e){o.CometChat.addUserListener(this.userListenerId,new o.CometChat.UserListener({onUserOnline:t=>{e(xe,t)},onUserOffline:t=>{e(Se,t)}})),o.CometChat.addGroupListener(this.groupListenerId,new o.CometChat.GroupListener({onGroupMemberScopeChanged:(t,s,i,n,r)=>{e(b,r,t,{user:s,scope:i})},onGroupMemberKicked:(t,s,i,n)=>{e(f,n,t,{user:s,hasJoined:!1})},onGroupMemberBanned:(t,s,i,n)=>{e(E,n,t,{user:s})},onGroupMemberUnbanned:(t,s,i,n)=>{e($,n,t,{user:s})},onMemberAddedToGroup:(t,s,i,n)=>{e(H,n,t,{user:s,hasJoined:!0})},onGroupMemberLeft:(t,s,i)=>{e(F,i,t,{user:s})},onGroupMemberJoined:(t,s,i)=>{e(B,i,t,{user:s})}})),o.CometChat.addMessageListener(this.conversationListenerId,new o.CometChat.MessageListener({onTextMessageReceived:t=>{e(Q,null,t)},onMediaMessageReceived:t=>{e(J,null,t)},onCustomMessageReceived:t=>{e(K,null,t)},onMessageDeleted:t=>{e(Z,null,t)},onMessageEdited:t=>{e(z,null,t)},onMessagesRead:t=>{e(V,null,t)}})),o.CometChat.addCallListener(this.callListenerId,new o.CometChat.CallListener({onIncomingCallReceived:t=>{e(w,null,t)},onIncomingCallCancelled:t=>{e(L,null,t)}}))}removeListeners(){o.CometChat.removeMessageListener(this.conversationListenerId),o.CometChat.removeUserListener(this.userListenerId),o.CometChat.removeGroupListener(this.groupListenerId),o.CometChat.removeCallListener(this.callListenerId)}}const xt=(l,e)=>({display:"flex",flexDirection:"column",height:"100%",boxSizing:"border-box",...l._parent===""?{border:`1px solid ${e.borderColor.primary}`}:{},"*":{boxSizing:"border-box","::-webkit-scrollbar":{width:"8px",height:"4px"},"::-webkit-scrollbar-track":{background:"#ffffff00"},"::-webkit-scrollbar-thumb":{background:"#ccc","&:hover":{background:"#aaa"}}}}),Lt=(l,e)=>({padding:"12px 16px",position:"relative",display:"flex",alignItems:"center",minHeight:e?"50px":"67px",borderBottom:`1px solid ${A}`}),wt=(l,e)=>{const t=[...e.breakPoints];return{cursor:"pointer",display:"none",mask:`url("${l}") no-repeat left center`,backgroundColor:`${e.primaryColor}`,height:"24px",width:"33%",[`@media ${t[0]}`]:{display:"block!important"}}},It=l=>(l.hasOwnProperty("enableCloseMenu")&&l.enableCloseMenu.length>0,{margin:"0",display:"inline-block",width:"100%",textAlign:"left",color:ee,fontFamily:"Poppins",fontSize:l.isFromUniversalMessaging?"20px":"24px",fontWeight:600,letterSpacing:0,lineHeight:"34px"}),ge=l=>({overflow:"hidden",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",top:l?"25%":"50%"}),pe=l=>({margin:"0",minHeight:"36px",color:`${l.color.secondary}`,fontSize:"20px!important",fontWeight:"600",lineHeight:"30px",wordWrap:"break-word",padding:"0 16px"}),yt=()=>({width:"100%",overflowY:"auto",margin:"0",padding:"0"}),_t=()=>({display:"flex",flexDirection:"column",alignItems:"center"}),Rt=()=>({margin:"0",fontSize:"18px",fontWeight:600,fontFamily:"Poppins"});class ne extends u.Component{loggedInUser=null;incrementUnreadCount=!1;static contextType=P;constructor(e){super(e),this._isMounted=!1,this.isMobile=window.innerWidth<=Ne,this.state={conversationlist:[],onItemClick:null,hideGroupActionMessages:!1,showConfirmDialog:!1,isLoading:!0,decoratorMessage:c.translate("LOADING",e.lang),conversationToBeDeleted:null},this.contextProviderRef=u.createRef(),this.chatListRef=u.createRef(),this.toastRef=u.createRef(),o.CometChat.getLoggedinUser().then(t=>this.loggedInUser=t).catch(t=>this.setState({isLoading:!1,decoratorMessage:c.translate("SOMETHING_WRONG",this.props.lang)}))}componentDidMount(){this._isMounted=!0,this.item=this.getContext().type===o.CometChat.ACTION_TYPE.TYPE_USER||o.CometChat.ACTION_TYPE.TYPE_GROUP?this.getContext().item:null,this.hideGroupActionMessages(),this.setState({conversationlist:[]},()=>{this.ConversationListManager=new St(this.getContext()),this.getConversations(),this.ConversationListManager.attachListeners(this.conversationCallback)}),D.on("updateLastMessage",e=>this.updateLastMessage(e)),D.on(he.NEW_MESSAGES,e=>this.updateUnreadCount(e)),D.on(he.CLEAR_UNREAD_MESSAGES,e=>this.clearUnreadCount(e))}componentDidUpdate(){if(this.markConversationAsRead({isHandled:!1}),this.item&&Object.keys(this.item).length&&this.item.hasOwnProperty("uid")&&this.getContext().type===o.CometChat.ACTION_TYPE.TYPE_USER&&this.item.uid===this.getContext().item.uid&&this.item.blockedByMe!==this.getContext().item.blockedByMe){let e=[...this.state.conversationlist],t=e.findIndex(s=>s.conversationType===o.CometChat.ACTION_TYPE.TYPE_USER&&s.conversationWith.uid===this.getContext().item.uid);if(t>-1){const s=e[t];let i={...s.conversationWith},n=Object.assign({},i,{blockedByMe:this.getContext().item.blockedByMe}),r=Object.assign({},s,{conversationWith:n});e.splice(t,1,r),this.setState({conversationlist:e})}}if(this.item&&Object.keys(this.item).length&&this.item.hasOwnProperty("guid")&&this.getContext().type===o.CometChat.ACTION_TYPE.TYPE_GROUP&&this.item.guid===this.getContext().item.guid&&this.item.membersCount!==this.getContext().item.membersCount){const e=[...this.state.conversationlist];let t=e.findIndex(s=>s.conversationType===o.CometChat.ACTION_TYPE.TYPE_GROUP&&s.conversationWith.guid===this.getContext().item.guid);if(t>-1){const s=e[t];let i={...s.conversationWith},n=Object.assign({},i,{membersCount:this.getContext().item.membersCount}),r=Object.assign({},s,{conversationWith:n});e.splice(t,1,r),this.setState({conversationlist:e})}}if(this.getContext().deletedGroupId.trim().length){const e=this.getContext().deletedGroupId.trim(),t=[...this.state.conversationlist];let s=t.findIndex(i=>i.conversationType===o.CometChat.ACTION_TYPE.TYPE_GROUP&&i.conversationWith.guid===e);s>-1&&(t.splice(s,1),this.setState({conversationlist:t}))}if(this.getContext().leftGroupId.trim().length){const e=this.getContext().leftGroupId.trim(),t=[...this.state.conversationlist];let s=t.findIndex(i=>i.conversationType===o.CometChat.ACTION_TYPE.TYPE_GROUP&&i.conversationWith.guid===e);s>-1&&(t.splice(s,1),this.setState({conversationlist:t}))}this.item=this.getContext().type===o.CometChat.ACTION_TYPE.TYPE_USER||o.CometChat.ACTION_TYPE.TYPE_GROUP?this.getContext().item:null,this.hideGroupActionMessages()}componentWillUnmount(){this._isMounted=!1,this.ConversationListManager.removeListeners(),this.ConversationListManager=null}markConversationAsRead=({isHandled:e=!1})=>{if(Object.keys(this.getContext().item).length&&this.getContext().type.length||this.getContext().item!==this.item){if(this.isMobile&&!e)return;const t=[...this.state.conversationlist],s=this.filterConversation();if(s&&s.unreadMessageCount>0&&this.incrementUnreadCount===!1){let i=t.indexOf(s),n={...s,unreadMessageCount:0};e||_.emit("clear_unread_count_conversation",s.unreadMessageCount),t.splice(i,1,n),this.setState({conversationlist:t})}}};filterConversation=()=>[...this.state.conversationlist].find(s=>s.conversationType===this.getContext().type&&this.getContext().type===o.CometChat.RECEIVER_TYPE.USER&&s.conversationWith.uid===this.getContext().item.uid||s.conversationType===this.getContext().type&&this.getContext().type===o.CometChat.RECEIVER_TYPE.GROUP&&s.conversationWith.guid===this.getContext().item.guid?s:!1);updateLastMessage=e=>{const t=[...this.state.conversationlist],s=t.findIndex(i=>i.conversationId===e.conversationId);if(s>-1){let n={...t[s],lastMessage:{...e}};s===0?t.splice(s,1,n):(t.splice(s,1),t.unshift(n)),this._isMounted&&this.setState({conversationlist:t})}else{const i=this.getContext().UIKitSettings.chatListMode,n=Y.chatListFilterOptions;if(i!==n.USERS_AND_GROUPS&&(i===n.USERS&&e.receiverType===o.CometChat.RECEIVER_TYPE.GROUP||i===n.GROUPS&&e.receiverType===o.CometChat.RECEIVER_TYPE.USER))return!1;let r=new o.CometChat.Conversation;r.setConversationId(e.conversationId),r.setConversationType(this.getContext().type),r.setConversationWith(this.getContext().item),r.setLastMessage(e),r.setUnreadMessageCount(0),t.unshift(r),this._isMounted&&this.setState({conversationlist:t})}};updateUnreadCount=e=>(this.incrementUnreadCount=!0,!1);clearUnreadCount=e=>{this.incrementUnreadCount=!1;let t=[...this.state.conversationlist];const s=this.filterConversation();if(s&&s.unreadMessageCount>0){let i=t.indexOf(s),n={...s,unreadMessageCount:0};t.splice(i,1,n),this.setState({conversationlist:t})}return!1};conversationCallback=(e,t,s,i)=>{switch(e){case xe:case Se:this.updateUser(t);break;case Q:case J:case K:this.markMessageAsDelivered(s),this.conversationUpdated(e,s,i);break;case w:case L:case z:case Z:case V:case H:case f:case E:case F:case b:case B:case $:this.conversationUpdated(e,s,i);break}};markMessageAsDelivered=e=>{(this.getContext().type===""||Object.keys(this.getContext().item).length===0)&&e.hasOwnProperty("deliveredAt")===!1&&o.CometChat.markAsDelivered(e).catch(t=>{})};conversationUpdated=(e,t,s)=>{const i=this.getContext().UIKitSettings.chatListMode,n=Y.chatListFilterOptions;if(i!==n.USERS_AND_GROUPS&&(i===n.USERS&&t.receiverType===o.CometChat.RECEIVER_TYPE.GROUP||i===n.GROUPS&&t.receiverType===o.CometChat.RECEIVER_TYPE.USER))return!1;switch(e){case Q:case J:case K:case w:case L:this.updateConversation(e,t);break;case z:case Z:this.conversationEditedDeleted(t);break;case H:this.updateGroupMemberAdded(t,s);break;case f:case E:case F:this.updateGroupMemberRemoved(t,s);break;case b:this.updateGroupMemberScopeChanged(t,s);break;case B:case $:this.updateGroupMemberChanged(t,s);break;case V:this.onMessagesRead(t);break}};updateUser=e=>{const t=[...this.state.conversationlist],s=t.findIndex(i=>i.conversationType===o.CometChat.ACTION_TYPE.TYPE_USER&&i.conversationWith.uid===e.uid);if(s>-1){let i={...t[s]},n={...i.conversationWith,status:e.getStatus()},r={...i,conversationWith:n};t.splice(s,1,r),this.setState({conversationlist:t})}};hideGroupActionMessages=()=>{this.getContext().FeatureRestriction.isGroupActionMessagesEnabled().then(e=>{e!==this.state.hideGroupActionMessages&&this.setState({hideGroupActionMessages:e})}).catch(e=>{this.state.hideGroupActionMessages!==!1&&this.setState({hideGroupActionMessages:!1})})};playAudio=e=>{if(e.category===o.CometChat.CATEGORY_ACTION&&e.type===o.CometChat.ACTION_TYPE.TYPE_GROUP_MEMBER&&this.state.hideGroupActionMessages===!0)return!1;const t=e.getReceiverType(),s=t===o.CometChat.RECEIVER_TYPE.USER?e.getSender().uid:e.getReceiverId();t===this.getContext().type?t===o.CometChat.RECEIVER_TYPE.USER&&s===this.getContext().item.uid||t===o.CometChat.RECEIVER_TYPE.GROUP&&s===this.getContext().item.guid?k.play(j.AUDIO.INCOMING_MESSAGE,this.getContext()):k.play(j.AUDIO.INCOMING_OTHER_MESSAGE,this.getContext()):k.play(j.AUDIO.INCOMING_OTHER_MESSAGE,this.getContext())};onMessagesRead=e=>{const t=[...this.state.conversationlist];t.forEach((s,i)=>{if(s?.conversationType===e.receiverType&&(s?.conversationType===o.CometChat.RECEIVER_TYPE.USER&&e.receiver===s?.conversationWith?.uid||s?.conversationType===o.CometChat.RECEIVER_TYPE.GROUP&&e.receiver===s?.conversationWith?.guid)){let n=s.unreadMessageCount;e?.messageId>=s?.lastMessage?.id&&(n=0);let r={...s,unreadMessageCount:n};t.splice(i,1,r),this.setState({conversationlist:t})}})};makeConversation=e=>new Promise(s=>{o.CometChat.CometChatHelper.getConversationFromMessage(e).then(i=>{let n=[...this.state.conversationlist],r=n.findIndex(d=>d.conversationId===i.conversationId),h={...i};r>-1&&(h={...n[r]}),s({conversationKey:r,conversationObj:h,conversationList:n})})});makeUnreadMessageCount=(e,t={})=>{if(Object.keys(t).length===0)return e.sender.uid===this.loggedInUser?.uid?0:1;let s=parseInt(t.unreadMessageCount);return this.getContext().item.hasOwnProperty("guid")&&t.conversationWith.hasOwnProperty("guid")&&this.getContext().item.guid===t.conversationWith.guid||this.getContext().item.hasOwnProperty("uid")&&t.conversationWith.hasOwnProperty("uid")&&this.getContext().item.uid===t.conversationWith.uid?this.incrementUnreadCount===!0?(_.emit("increment_messages_count",1),s=++s):s=0:(_.emit("increment_messages_count",1),s=this.shouldIncrementCount(e)?++s:s),s};shouldIncrementCount=e=>{let t=!1;return(e.category===o.CometChat.CATEGORY_MESSAGE&&e.sender.uid!==this.loggedInUser?.uid||this.getContext().hasKeyValue(e,T.METADATA)&&this.getContext().hasKeyValue(e[T.METADATA],T.INCREMENT_UNREAD_COUNT)&&e[T.METADATA][T.INCREMENT_UNREAD_COUNT]===!0&&e.sender.uid!==this.loggedInUser?.uid)&&(t=!0),t};makeLastMessage=(e,t={})=>Object.assign({},e);updateConversation=(e,t)=>{this.makeConversation(t).then(s=>{const{conversationKey:i,conversationObj:n,conversationList:r}=s;if(i>-1){let h=this.makeUnreadMessageCount(t,n),d=this.makeLastMessage(t,n),p={...n,lastMessage:d,unreadMessageCount:h};r.splice(i,1),r.unshift(p),this.setState({conversationlist:r}),e!==w&&e!==L&&this.playAudio(t)}else{let h=this.makeUnreadMessageCount(t,{}),d=this.makeLastMessage(t),p={...n,lastMessage:d,unreadMessageCount:h};r.unshift(p),this.setState({conversationlist:r}),e!==w&&e!==L&&this.playAudio(t)}})};conversationEditedDeleted=e=>{this.makeConversation(e).then(t=>{const{conversationKey:s,conversationObj:i,conversationList:n}=t;if(s>-1){let r=i.lastMessage;if(r.id===e.id){const h=Object.assign({},r,e);let d=Object.assign({},i,{lastMessage:h});n.splice(s,1,d),this.setState({conversationlist:n})}}})};updateGroupMemberAdded=(e,t)=>{this.makeConversation(e).then(s=>{const{conversationKey:i,conversationObj:n,conversationList:r}=s;if(i>-1){let h=this.makeLastMessage(e,n),d={...n.conversationWith},p=parseInt(d.membersCount);e.hasOwnProperty("actionFor")&&e.actionFor.hasOwnProperty("membersCount")&&(p=e.actionFor.membersCount);let C={...d,membersCount:p},M={...n,conversationWith:C,lastMessage:h};r.splice(i,1),r.unshift(M),this.setState({conversationlist:r}),this.playAudio(e)}else if(t&&this.loggedInUser.uid===t.user.uid){let h=this.makeLastMessage(e),d={...n.conversationWith},p=parseInt(d.membersCount);e.hasOwnProperty("actionFor")&&e.actionFor.hasOwnProperty("membersCount")&&(p=e.actionFor.membersCount);let C=o.CometChat.GROUP_MEMBER_SCOPE.PARTICIPANT,M=t.hasJoined,U={...d,membersCount:p,scope:C,hasJoined:M},Ie={...n,conversationWith:U,lastMessage:h};r.unshift(Ie),this.setState({conversationlist:r}),this.playAudio(e)}})};updateGroupMemberRemoved=(e,t)=>{this.makeConversation(e).then(s=>{const{conversationKey:i,conversationObj:n,conversationList:r}=s;if(i>-1)if(t&&this.loggedInUser.uid===t.user.uid)r.splice(i,1),this.setState({conversationlist:r});else{let h=this.makeLastMessage(e,n),d={...n.conversationWith},p=parseInt(d.membersCount);e.hasOwnProperty("actionFor")&&e.actionFor.hasOwnProperty("membersCount")&&(p=e.actionFor.membersCount);let C={...d,membersCount:p},M={...n,conversationWith:C,lastMessage:h};r.splice(i,1),r.unshift(M),this.setState({conversationlist:r}),this.playAudio(e)}})};updateGroupMemberScopeChanged=(e,t)=>{this.makeConversation(e).then(s=>{const{conversationKey:i,conversationObj:n,conversationList:r}=s;if(i>-1){let h=this.makeLastMessage(e,n),d={...n.conversationWith},p=parseInt(d.membersCount),C=d.scope;t&&this.loggedInUser.uid===t.user.uid&&(C=t.scope);let M={...d,membersCount:p,scope:C},U={...n,conversationWith:M,lastMessage:h};r.splice(i,1),r.unshift(U),this.setState({conversationlist:r}),this.playAudio(e)}})};updateGroupMemberChanged=(e,t)=>{this.makeConversation(e).then(s=>{const{conversationKey:i,conversationObj:n,conversationList:r}=s;if(i>-1&&t&&this.loggedInUser.uid!==t.user.uid){let h=this.makeLastMessage(e,n),d={...n.conversationWith},p=parseInt(d.membersCount);e.hasOwnProperty("actionFor")&&e.actionFor.hasOwnProperty("membersCount")&&(p=e.actionFor.membersCount);let C={...d,membersCount:p},M={...n,conversationWith:C,lastMessage:h};r.splice(i,1),r.unshift(M),this.setState({conversationlist:r}),this.playAudio(e)}})};handleScroll=e=>{Math.round(e.currentTarget.scrollHeight-e.currentTarget.scrollTop)===Math.round(e.currentTarget.clientHeight)&&this.getConversations()};handleClick=e=>{this.props.onItemClick&&(_.emit("clear_unread_count_conversation",e.unreadMessageCount),this.markConversationAsRead({isHandled:!0}),this.props.onItemClick(e.conversationWith,e.conversationType,e?.tags,e?.conversationId))};handleMenuClose=()=>{if(!this.props.actionGenerated)return!1;this.props.actionGenerated(m.TOGGLE_SIDEBAR)};filterTenantPlacementConversations=e=>ot(e,{userListingsWithActiveTenantPlacement:this.props.userListingsWithActiveTenantPlacement},this.loggedInUser);getConversations=()=>{this.ConversationListManager.fetchNextConversation().then(e=>{const t=e.filter(r=>!((r?.tags&&r.tags.includes("archive_conversation")||r?.conversationWith?.tags&&r?.conversationWith?.tags?.includes("archive_conversation"))&&this.loggedInUser?.role==="owner")),s=this.filterTenantPlacementConversations(t);s.length===0?(this.loggedInUser?.role==="owner"&&Object.keys(this.getContext().item).length===0&&this.getContext().setItem({}),this.state.conversationlist.length===0&&this.setState({isLoading:!1,decoratorMessage:c.translate("NO_CHATS_FOUND",this.props.lang)})):this.setState({isLoading:!1,decoratorMessage:""});let i=[...this.state.conversationlist];if(!s.find(r=>r.conversationType===o.CometChat.RECEIVER_TYPE.GROUP?r?.conversationWith?.guid===this.context.item.guid:r?.conversationWith?.uid===this.context.item.uid)&&this.loggedInUser?.role==="owner"&&s.length>0&&(this.getContext().setItem(s[0].conversationWith),this.getContext().setType(s[0].conversationType??o.CometChat.ACTION_TYPE.TYPE_USER)),s.forEach(r=>{let h=i.findIndex(d=>d.conversationId===r.conversationId);if(h>-1){const d=i[h].unreadMessageCount+r.unreadMessageCount,p={...i[h],unreadMessageCount:d};i.splice(h,1,p),s.splice(h,1)}}),this.props.initialChatId){const r=s.find(h=>h?.conversationWith?.uid.endsWith(this.props.initialChatId)&&h.conversationType===o.CometChat.RECEIVER_TYPE.USER);r&&(this.props.onItemClick(r.conversationWith,r.conversationType,r?.tags,r?.conversationId),this.props.resetInitialChatId())}this.setState({conversationlist:[...i,...s]})}).catch(e=>this.setState({isLoading:!1,decoratorMessage:c.translate("SOMETHING_WRONG",this.props.lang)}))};getContext=()=>this.props._parent.length?this.context:this.contextProviderRef.state;actionHandler=(e,t)=>{switch(e){case m.CONVERSATION_DELETED:this.conversationDeleted(t);break;case m.DELETE_CONVERSATION:this.deleteConversation(t);break}};deleteConversation=e=>{this.state.showConfirmDialog||this.setState({showConfirmDialog:!0,conversationToBeDeleted:e})};onDeleteConfirm=e=>{const t=e.target.value;if(this.setState({showConfirmDialog:!1}),t==="yes"){const s=this.state.conversationToBeDeleted,i=s.conversationType===o.CometChat.RECEIVER_TYPE.GROUP?s?.conversationWith?.guid:s?.conversationWith?.uid;o.CometChat.deleteConversation(i,s.conversationType).then(n=>{this.conversationDeleted(s)}).catch(n=>this.toastRef.setError("SOMETHING_WRONG"))}else this.setState({showConfirmDialog:!1,conversationToBeDeleted:null})};conversationDeleted=e=>{const t=[...this.state.conversationlist],s=t.findIndex(i=>i.conversationId===e.conversationId);s>-1&&((e.conversationType===this.getContext().type&&this.getContext().type===o.CometChat.RECEIVER_TYPE.USER&&e.conversationWith.uid===this.getContext().item.uid||e.conversationType===this.getContext().type&&this.getContext().type===o.CometChat.RECEIVER_TYPE.GROUP&&e.conversationWith.guid===this.getContext().item.guid)&&this.getContext().setTypeAndItem("",{}),t.splice(s,1),this.setState({conversationlist:t,conversationToBeDeleted:null}))};render(){const e=this.state.conversationlist.map((h,d)=>a(ie,{key:h.conversationId,conversation:h,loggedInUser:this.loggedInUser,handleClick:this.handleClick,actionGenerated:this.actionHandler,selectedConversation:this.getContext().item}));let t=null;this.state.decoratorMessage.length!==0&&!this.state.conversationlist.length&&(t=a("div",{css:ge(this.props.isFromUniversalMessaging),className:"chats__decorator-message"},this.props.isFromUniversalMessaging?a("div",{css:_t()},a(Qe,{style:{height:200}}),a("p",{css:Rt()},"Loading chats...")):a("p",{css:pe(v),className:"decorator-message"},this.state.decoratorMessage))),this.props.loadingUser&&(t=a("div",{css:ge(),className:"chats__decorator-message"},a("p",{css:pe(v),className:"decorator-message"},"Loading...")));let s=a("div",{css:wt(Tt,v),className:"header__close",onClick:this.handleMenuClose});this.getContext()&&Object.keys(this.getContext().item).length===0&&(s=null);let i=null;this.state.showConfirmDialog&&(i=a(Xe,{...this.props,onClick:this.onDeleteConfirm,message:c.translate("DELETE_CONFIRM",this.getContext().language),confirmButtonText:c.translate("DELETE",this.getContext().language),cancelButtonText:c.translate("CANCEL",this.getContext().language)}));const n=a("div",{css:xt(this.props,v),className:"chats"},a("div",{css:Lt(v,this.props.isFromUniversalMessaging),className:"chats__header"},s,a("h4",{css:It(this.props),className:"header__title",dir:c.getDirection(this.props.lang)},c.translate(this.props.isFromUniversalMessaging?"Chats":"Messages",this.props.lang)),this.props.newMessageModal(this.props.hasActiveRenters)),this.props.hasActiveRenters&&this.props.tabNavigation(),e.length===0&&!this.state.isLoading&&!this.props.loadingUser?a(qe,{style:this.props.isFromUniversalMessaging?{padding:16,display:"flex",flexDirection:"column",height:"80%",justifyContent:"center",alignItems:"center"}:{padding:16},isFromUniversalMessaging:this.props.isFromUniversalMessaging,hasActiveRenters:this.props.hasActiveRenters}):t,a("div",{css:yt(),className:"chats__list",onScroll:this.handleScroll,ref:h=>this.chatListRef=h},e),i,a(Le,{ref:h=>this.toastRef=h,lang:this.props.lang}));let r=n;return this.props._parent===""&&(r=a(te,{ref:h=>this.contextProviderRef=h},n)),r}}ne.defaultProps={lang:c.getDefaultLanguage(),theme:v,onItemClick:()=>{},tabNavigation:()=>{},newMessageModal:()=>{},_parent:"",hasActiveRenters:!1,loadingUser:!0};ne.propTypes={lang:g.string,theme:g.object,onItemClick:g.func,tabNavigation:g.func,newMessageModal:g.func,_parent:g.string,hasActiveRenters:g.bool,loadingUser:g.bool,userListingsWithActiveTenantPlacement:g.object};const X=l=>{const{user:e,loadingUser:t}=Pe(),{initialChatId:s,resetInitialChatId:i}=Ee(),{userListingsWithActiveTenantPlacement:n}=Ue(),{IS_RENTER:r}=ve(),h=r?!0:(e?.leads_count?.all||0)+(e?.tenants_count||0)+(e?.applicants_count||0)>0;return a(ne,{...l,hasActiveRenters:h,loadingUser:!!t,initialChatId:s,resetInitialChatId:i,userListingsWithActiveTenantPlacement:n})},Ot=l=>({display:"flex",flexDirection:"column!important",height:"calc(100% - 50px)",fontFamily:`${l.theme.fontFamily}`,"*":{boxSizing:"border-box",fontFamily:`${l.theme.fontFamily}`}}),At=l=>({padding:"16px",position:"relative",borderBottom:`1px solid ${l.theme.borderColor.primary}`,height:"70px",display:"flex",alignItems:"center"}),Pt=()=>({margin:"0",fontSize:"22px",fontWeight:"700",lineHeight:"26px"}),Ut=()=>({padding:"16px",display:"flex",flexDirection:"row",justifyContent:"left",alignItems:"center"}),Nt=()=>({display:"inline-block",width:"36px",height:"36px",flexShrink:"0"}),Dt=()=>({width:"calc(100% - 45px)",flexGrow:"1",paddingLeft:"16px","&[dir=rtl]":{paddingRight:"16px",paddingLeft:"0"}}),kt=()=>({margin:"0",fontSize:"15px",fontWeight:"600",display:"block",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),jt=l=>({fontSize:"13px",margin:"0",color:`${l.theme.color.blue}`}),Gt=()=>({height:"calc(100% - 145px)",overflowY:"auto",padding:"0 16px",display:"flex",flexDirection:"column",justifyContent:"left",alignItems:"flex-start"}),ue=l=>({margin:"5px 0",width:"100%",fontSize:"12px",color:`${l.theme.color.helpText}`,textTransform:"uppercase"}),me=()=>({padding:"10px 0",width:"100%",fontSize:"15px"}),S=l=>({width:"100%",padding:"16px 16px 16px 36px",fontWeight:600,background:`url(${l}) left center no-repeat`}),x=()=>({width:"100%"}),Wt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10.6002%2019.8006C10.7018%2020.1468%2010.9128%2020.4507%2011.2016%2020.6669C11.4904%2020.8831%2011.8415%2021%2012.2023%2021C12.563%2021%2012.9141%2020.8831%2013.2029%2020.6669C13.4917%2020.4507%2013.7027%2020.1468%2013.8043%2019.8006'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M12.2003%204.80007V3'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M12.2003%204.80006C13.7916%204.80006%2015.3178%205.43223%2016.4431%206.55749C17.5683%207.68275%2018.2005%209.20893%2018.2005%2010.8003C18.2005%2016.4373%2019.4005%2017.4005%2019.4005%2017.4005H5C5%2017.4005%206.20004%2015.8677%206.20004%2010.8003C6.20004%209.20893%206.83221%207.68275%207.95747%206.55749C9.08273%205.43223%2010.6089%204.80006%2012.2003%204.80006V4.80006Z'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Yt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M16.9485%206.85714C16.9485%206.51615%2017.084%206.18912%2017.3251%205.94801C17.5662%205.70689%2017.8932%205.57143%2018.2342%205.57143C18.5752%205.57143%2018.9023%205.70689%2019.1434%205.94801C19.3845%206.18912%2019.52%206.51615%2019.52%206.85714V16.608C19.5204%2017.1849%2019.4071%2017.7562%2019.1865%2018.2892C18.9658%2018.8222%2018.6423%2019.3065%2018.2342%2019.7143C17.8267%2020.122%2017.3429%2020.4454%2016.8103%2020.666C16.2778%2020.8866%2015.707%2021.0001%2015.1305%2021H12.6294C11.7827%2021.0002%2010.949%2020.7913%2010.2025%2020.3919C9.45588%2019.9925%208.81945%2019.415%208.34967%2018.7106L5.2211%2014.0177C5.07692%2013.801%205%2013.5465%205%2013.2861C5%2013.0258%205.07692%2012.7713%205.2211%2012.5546V12.5546C5.3226%2012.4024%205.45466%2012.2729%205.60889%2012.1745C5.76311%2012.076%205.93613%2012.0108%206.11693%2011.9828C6.29774%2011.9548%206.4824%2011.9648%206.65915%2012.012C6.83591%2012.0592%207.00091%2012.1427%207.14367%2012.2571L9.23424%2013.9294V5.57143C9.23424%205.23044%209.3697%204.90341%209.61082%204.66229C9.85194%204.42117%2010.179%204.28571%2010.52%204.28571C10.8609%204.28571%2011.188%204.42117%2011.4291%204.66229C11.6702%204.90341%2011.8057%205.23044%2011.8057%205.57143V4.28571C11.8057%203.94472%2011.9411%203.6177%2012.1822%203.37658C12.4234%203.13546%2012.7504%203%2013.0914%203C13.4324%203%2013.7594%203.13546%2014.0005%203.37658C14.2416%203.6177%2014.3771%203.94472%2014.3771%204.28571V5.57143C14.3771%205.23044%2014.5126%204.90341%2014.7537%204.66229C14.9948%204.42117%2015.3218%204.28571%2015.6628%204.28571C16.0038%204.28571%2016.3308%204.42117%2016.572%204.66229C16.8131%204.90341%2016.9485%205.23044%2016.9485%205.57143V6.85714Z'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M11.8057%205.56885V10.7117'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14.3771%205.56885V10.7117'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M16.9485%2010.7117V6.85457'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Bt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12.7239%202.00001C10.8958%201.99762%209.10022%202.44038%207.5236%203.28236C5.94699%204.12434%204.64676%205.33486%203.75785%206.78829C2.86894%208.24172%202.42373%209.8851%202.46844%2011.5479C2.51314%2013.2107%203.04612%2014.8323%204.01207%2016.2444L1%2022L7.32505%2019.2596C8.67399%2020.0226%2010.1993%2020.4903%2011.7807%2020.6256C13.3621%2020.761%2014.9565%2020.5604%2016.4382%2020.0396C17.9199%2019.5189%2019.2484%2018.6922%2020.3191%2017.6247C21.3898%2016.5572%2022.1734%2015.2781%2022.6082%2013.8881C23.043%2012.4981%2023.1171%2011.0353%2022.8246%209.61484C22.5321%208.19438%2021.8811%206.85512%2020.9229%205.70258C19.9646%204.55003%2018.7252%203.61569%2017.3024%202.97318C15.8797%202.33066%2014.3123%201.99753%2012.7239%202.00001V2.00001Z'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Ft="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9.59998%209.6C9.60006%209.16002%209.72109%208.72853%209.94983%208.35269C10.1786%207.97685%2010.5062%207.67112%2010.897%207.46892C11.2878%207.26672%2011.7266%207.17582%2012.1655%207.20617C12.6044%207.23652%2013.0266%207.38694%2013.3858%207.641C13.745%207.89505%2014.0275%208.24296%2014.2023%208.64671C14.3772%209.05045%2014.4377%209.49449%2014.3772%209.93029C14.3167%2010.3661%2014.1376%2010.7769%2013.8595%2011.1178C13.5813%2011.4587%2013.2148%2011.7165%2012.8%2011.8632C12.5659%2011.946%2012.3633%2012.0993%2012.22%2012.302C12.0767%2012.5047%2011.9998%2012.7469%2012%2012.9952V13.8'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M12%2016.2C11.9406%2016.2%2011.8826%2016.2176%2011.8333%2016.2506C11.7839%2016.2835%2011.7455%2016.3304%2011.7228%2016.3852C11.7001%2016.44%2011.6941%2016.5003%2011.7057%2016.5585C11.7173%2016.6167%2011.7459%2016.6702%2011.7878%2016.7121C11.8298%2016.7541%2011.8832%2016.7827%2011.9414%2016.7942C11.9996%2016.8058%2012.0599%2016.7999%2012.1148%2016.7772C12.1696%2016.7545%2012.2164%2016.716%2012.2494%2016.6667C12.2824%2016.6173%2012.3%2016.5593%2012.3%2016.5C12.3%2016.4204%2012.2683%2016.3441%2012.2121%2016.2879C12.1558%2016.2316%2012.0795%2016.2%2012%2016.2Z'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M3%2012C3%2014.3869%203.94821%2016.6761%205.63604%2018.364C7.32387%2020.0518%209.61305%2021%2012%2021C14.3869%2021%2016.6761%2020.0518%2018.364%2018.364C20.0518%2016.6761%2021%2014.3869%2021%2012C21%209.61305%2020.0518%207.32387%2018.364%205.63604C16.6761%203.94821%2014.3869%203%2012%203C9.61305%203%207.32387%203.94821%205.63604%205.63604C3.94821%207.32387%203%209.61305%203%2012V12Z'%20stroke='%23808080'%20stroke-width='1.5'/%3e%3c/svg%3e",Ht="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12%2017.4C11.9406%2017.4%2011.8826%2017.4176%2011.8333%2017.4505C11.7839%2017.4835%2011.7455%2017.5303%2011.7228%2017.5852C11.7001%2017.64%2011.6941%2017.7003%2011.7057%2017.7585C11.7173%2017.8167%2011.7459%2017.8701%2011.7878%2017.9121C11.8298%2017.9541%2011.8832%2017.9826%2011.9414%2017.9942C11.9996%2018.0058%2012.0599%2017.9998%2012.1148%2017.9771C12.1696%2017.9544%2012.2164%2017.916%2012.2494%2017.8666C12.2824%2017.8173%2012.3%2017.7593%2012.3%2017.7C12.3%2017.6204%2012.2683%2017.5441%2012.2121%2017.4878C12.1558%2017.4316%2012.0795%2017.4%2012%2017.4Z'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M12%2014.9999V8.99986'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3cpath%20d='M13.2968%203.80782C13.1777%203.56543%2012.9931%203.36126%2012.7639%203.21847C12.5347%203.07569%2012.2701%203%2012%203C11.7299%203%2011.4653%203.07569%2011.2361%203.21847C11.0069%203.36126%2010.8223%203.56543%2010.7032%203.80782L3.12481%2019.2464C3.03358%2019.432%202.99116%2019.6377%203.00153%2019.8442C3.01191%2020.0508%203.07475%2020.2512%203.18411%2020.4267C3.29347%2020.6022%203.44576%2020.747%203.62659%2020.8473C3.80742%2020.9476%204.01082%2021.0001%204.21761%2021H19.7824C19.9892%2021.0001%2020.1926%2020.9476%2020.3734%2020.8473C20.5542%2020.747%2020.7065%2020.6022%2020.8159%2020.4267C20.9253%2020.2512%2020.9881%2020.0508%2020.9985%2019.8442C21.0088%2019.6377%2020.9664%2019.432%2020.8752%2019.2464L13.2968%203.80782Z'%20stroke='%23808080'%20stroke-width='1.5'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e";class oe extends u.Component{constructor(e){super(e),this.state={loggedInUser:null},this.toastRef=u.createRef()}componentDidMount(){o.CometChat.getLoggedinUser().then(e=>{this.setState({loggedInUser:e})}).catch(e=>this.toastRef.setError("SOMETHING_WRONG"))}render(){let e=null;if(this.state.loggedInUser){let t=a(W,{user:this.state.loggedInUser});e=a(u.Fragment,null,a("div",{css:At(this.props),className:"userinfo__header"},a("h4",{css:Pt(),className:"header__title"},c.translate("MORE",this.props.lang))),a("div",{css:Ut(),className:"userinfo__detail"},a("div",{css:Nt(),className:"detail__thumbnail"},t),a("div",{css:Dt(),className:"detail__user",dir:c.getDirection(this.props.lang)},a("div",{css:kt(),className:"user__name"},this.state.loggedInUser.name),a("p",{css:jt(this.props),className:"user__status"},c.translate("ONLINE",this.props.lang)))),a("div",{css:Gt(),className:"userinfo__options"},a("div",{css:ue(this.props),className:"options__title"},c.translate("PREFERENCES",this.props.lang)),a("div",{css:me(),className:"options_list"},a("div",{css:S(Wt),className:"option option-notification"},a("div",{css:x(),className:"option_name"},c.translate("NOTIFICATIONS",this.props.lang))),a("div",{css:S(Yt),className:"option option-privacy"},a("div",{css:x(),className:"option_name"},c.translate("PRIVACY_AND_SECURITY",this.props.lang))),a("div",{css:S(Bt),className:"option option-chats"},a("div",{css:x(),className:"option_name"},c.translate("Messages",this.props.lang)))),a("div",{css:ue(this.props),className:"options__title"},c.translate("OTHER",this.props.lang)),a("div",{css:me(),className:"options_list"},a("div",{css:S(Ft),className:"option option-help"},a("div",{css:x(),className:"option_name"},c.translate("HELP",this.props.lang))),a("div",{css:S(Ht),className:"option option-report"},a("div",{css:x(),className:"option_name"},c.translate("REPORT_PROBLEM",this.props.lang))))))}return a("div",{css:Ot(this.props),className:"userinfo"},e,a(Le,{ref:t=>this.toastRef=t,lang:this.props.lang}))}}oe.defaultProps={lang:c.getDefaultLanguage(),theme:v};oe.propTypes={lang:g.string,theme:g.object};const $t=l=>({width:"100%",zIndex:"1",borderBottom:l?`1px solid ${A}`:`4px solid ${A}`}),Vt=()=>({display:"flex",flexDirection:"row",width:"100%",height:"100%",padding:"0 16px"}),R=l=>({borderBottom:l?`4px solid ${le}`:"none",display:"inline-block",cursor:"pointer",whiteSpace:"nowrap",marginRight:"24px",marginBottom:"-4px",padding:"12px 0",color:l?le:q,"&:hover":{color:_e}}),O=()=>({paddingTop:"2px",fontSize:16,lineHeight:"initial",letterSpacing:.3,textTransform:"uppercase",fontWeight:"bold"}),zt=()=>({height:"34px",maxWidth:"120px",fontSize:"12px",fontWeight:"bold",letterSpacing:"0.25px",lineHeight:"18px",textAlign:"center"}),Me=()=>({cursor:"pointer"});class Zt extends u.Component{static contextType=P;tabListKeys=[];constructor(e){super(e),this.state={activeTab:null,tabList:[],newMessageModal:!1,enableSearchUser:!1,newMessagesUniversalMessaging:!1,userlist:[],decoratorMessage:c.translate("LOADING",e.lang)},o.CometChat.getLoggedinUser().then(t=>this.loggedInUser=t).catch(t=>{console.error(t)})}componentDidMount(){this.context.UIKitSettings.tabs.forEach(t=>{for(const s in de)t===de[s]&&this.tabListKeys.push(s)}),this.getFilteredTabs().then(t=>{this.props.onTabChange(t[0]),this.setState({tabList:t,activeTab:t[0]})})}getFilteredTabs=()=>new Promise(e=>{const t=[],s=[this.enableChats(),this.enableUsers(),this.enableSettings()];Promise.allSettled(s).then(i=>{this.tabListKeys.forEach(n=>{i.forEach(r=>{const h=r.value[0],d=r.value[1];n===h&&d===!0&&t.push(n)})}),e(t)})});enableChats=()=>new Promise(e=>{this.context.FeatureRestriction.isRecentChatListEnabled().then(t=>e(["SIDEBAR_CHATS",t])).catch(t=>e(["SIDEBAR_CHATS",!1]))});enableUsers=()=>new Promise(e=>{this.context.FeatureRestriction.isUserListEnabled().then(t=>e(["SIDEBAR_USERS",t])).catch(t=>e(["SIDEBAR_USERS",!1]))});enableGroups=()=>new Promise(e=>{this.context.FeatureRestriction.isGroupListEnabled().then(t=>e(["SIDEBAR_GROUPS",t])).catch(t=>e(["SIDEBAR_GROUPS",!1]))});enableSettings=()=>new Promise(e=>{this.context.FeatureRestriction.isUserSettingsEnabled().then(t=>e(["SIDEBAR_MOREINFO",t])).catch(t=>e(["SIDEBAR_MOREINFO",!1]))});tabChanged=e=>{this.setState({activeTab:e}),this.props.onTabChange(e),this.context.setItem({})};getActiveTab=()=>{switch(this.state.activeTab){case"SIDEBAR_USERS":return a(tt,{theme:this.props.theme,lang:this.context.language,_parent:"unified",actionGenerated:this.props.actionGenerated,tabNavigation:this.getTabList,newMessageModal:this.getNewMessageButton,onItemClick:(e,t)=>this.props.actionGenerated(m.ITEM_CLICKED,t,e)});case"SIDEBAR_CALLS":return null;case"SIDEBAR_CHATS":return a(X,{theme:this.props.theme,lang:this.context.language,_parent:"unified",actionGenerated:this.props.actionGenerated,tabNavigation:this.getTabList,newMessageModal:this.getNewMessageButton,onItemClick:(e,t,s,i)=>{this.props.actionGenerated(m.ITEM_CLICKED,t,e,s,i)}});case"SIDEBAR_GROUPS":return a(et,{theme:this.props.theme,lang:this.context.language,_parent:"unified",actionGenerated:this.props.actionGenerated,tabNavigation:this.getTabList,onItemClick:(e,t)=>this.props.actionGenerated(m.ITEM_CLICKED,t,e)});case"SIDEBAR_MOREINFO":return a(oe,{theme:this.props.theme,lang:this.context.language,isFromUniversalMessaging:this.props.isFromUniversalMessaging,onItemClick:(e,t)=>this.props.actionGenerated(m.ITEM_CLICKED,t,e)});default:return null}};getNewMessageButton=e=>this.props.isFromUniversalMessaging?e?a("div",{css:Me(),onClick:()=>{y("pen_icon clicked",{location:"Chat Bubble"}),this.setState({newMessageModal:!0})}},a(nt,null)):a("div",{css:Me(),onClick:()=>{this.props.toggleChat()}},a(De,{color:"#033A6D"})):e?a(Re,{secondary:!0,onClick:()=>{y("new message clicked",{location:"Messages"}),this.setState({newMessageModal:!0})},css:zt()},"New Message"):null;getTabList=()=>{const e=this.state.activeTab==="SIDEBAR_CHATS",t=this.state.activeTab==="SIDEBAR_USERS",s=this.state.activeTab==="SIDEBAR_GROUPS",i=this.state.activeTab==="SIDEBAR_MOREINFO",n=[...this.state.tabList],r=this.loggedInUser?.role==="owner";if(!r)return null;const h=n.map(d=>{switch(d){case"SIDEBAR_CHATS":return a("div",{key:d,css:R(e),className:"navbar__item",onClick:()=>{y("chats tab clicked",{location:"Messages"}),this.tabChanged("SIDEBAR_CHATS")}},a("div",{css:O(),className:"item__label"},c.translate("CHATS",this.context.language)));case"SIDEBAR_USERS":return a("div",{key:d,css:R(t),className:"navbar__item",onClick:()=>{y(`${r?"renters":"owners"} tab clicked`,{location:"Messages"}),this.tabChanged("SIDEBAR_USERS")}},a("div",{css:O(),className:"item__label"},c.translate(r?"Renters":"Owners",this.context.language)));case"SIDEBAR_GROUPS":return a("div",{key:d,css:R(s),className:"navbar__item",onClick:()=>this.tabChanged("SIDEBAR_GROUPS")},a("div",{css:O(),className:"item__label"},c.translate("GROUPS",this.context.language)));case"SIDEBAR_MOREINFO":return a("div",{key:d,css:R(i),className:"navbar__item",onClick:()=>this.tabChanged("SIDEBAR_MOREINFO")},a("div",{css:O(),className:"item__label"},c.translate("MORE",this.context.language)));default:return null}});return a("div",{css:$t(this.props.isFromUniversalMessaging),className:"header__navbar_container"},a("div",{css:Vt(),className:"header__navbar"},this.props.isFromUniversalMessaging?null:h))};render(){return a(u.Fragment,null,this.props.isFromUniversalMessaging?a(X,{theme:this.props.theme,lang:this.context.language,_parent:"unified",actionGenerated:this.props.actionGenerated,tabNavigation:this.getTabList,isFromUniversalMessaging:this.props.isFromUniversalMessaging,newMessageModal:this.getNewMessageButton,initialChatId:this.props.initialChatId,onItemClick:(e,t,s,i)=>{this.props.actionGenerated(m.ITEM_CLICKED,t,e,s,i)}}):this.getActiveTab(),this.state.newMessageModal&&a(st,{open:!0,isFromUniversalMessaging:this.props.isFromUniversalMessaging,onClose:()=>this.setState({newMessageModal:!1}),actionGenerated:this.props.actionGenerated,refreshComponent:this.props.refreshComponent}))}}const ae=l=>{const{toggleChat:e}=Ee();return a(Zt,{...l,toggleChat:e})};ae.defaultProps={theme:v};ae.propTypes={theme:g.object,onTabChange:g.func};const Kt=l=>({backgroundColor:"#fff",display:"flex",height:"100%",width:"100%",maxHeight:"100vh",boxSizing:"border-box",fontFamily:`${l.theme.fontFamily}`,border:l.isFromUniversalMessaging?"unset":`1px solid ${l.theme.borderColor.primary}`,position:"relative","*":{boxSizing:"border-box",fontFamily:`${l.theme.fontFamily}`,"::-webkit-scrollbar":{width:"8px",height:"4px"},"::-webkit-scrollbar-track":{background:"#ffffff00"},"::-webkit-scrollbar-thumb":{background:"#ccc","&:hover":{background:"#aaa"}}},...l.isFromUniversalMessaging&&{height:"100vh",width:"100%"}}),Jt=(l,e)=>{const t=l.sidebarview?{left:"0"}:{},s=[...e.theme.breakPoints];return{width:"320px",minWidth:"320px",borderRight:`1px solid ${e.theme.borderColor.primary}`,height:"100%",position:"relative",display:"flex",flexDirection:"column","> .contacts, .chats, .groups, .userinfo":{height:"100%"},[`@media ${s[0]}`]:{position:"absolute!important",left:"-100%",top:"0",bottom:"0",width:"100%!important",minWidth:"unset",zIndex:"2",backgroundColor:`${e.theme.backgroundColor.white}`,transition:"all .3s ease-out",...t},...e.isFromUniversalMessaging&&{position:"absolute",left:"-100%",top:"0",bottom:"0",width:"100%",minWidth:"unset",zIndex:"2",backgroundColor:`${e.theme.backgroundColor.white}`,transition:"all .3s ease-out",...t}}},Qt=(l,e)=>{const t=[...e.theme.breakPoints];return{width:"calc(100% - 320px)",height:"100%",order:"2",display:"flex",flexDirection:"row",[`@media ${t[1]}, ${t[2]}`]:{width:"100%"},...e.isFromUniversalMessaging&&{width:"100%"}}};class re extends u.Component{loggedInUser=null;constructor(e){super(e),this.state={activeTab:"",sidebarview:!1,reloadKey:0,newMessagesUniversalMessaging:!1},this.navBarRef=u.createRef(),this.contextProviderRef=u.createRef()}componentDidMount(){this.props.chatWithUser.length===0&&this.props.chatWithGroup.length===0&&this.toggleSideBar(),this.props.receiverUID&&this.openInitialConversation()}openInitialConversation=async()=>{const e=ke(this.props.receiverUID),t=e.startsWith("group_");if(e){const s=t?o.CometChat.ACTION_TYPE.TYPE_GROUP:o.CometChat.ACTION_TYPE.TYPE_USER,i=await o.CometChat.getConversation(e,s),n=i.conversationWith;this?.contextProviderRef?.setTypeAndItem(s,n),this?.contextProviderRef?.setTagsAndConversationId(i.tags,i.conversationId),this.toggleSideBar()}};navBarAction=(e,t,s,i=[],n="")=>{switch(e){case m.ITEM_CLICKED:this.itemClicked(s,t,i,n);break;case m.TOGGLE_SIDEBAR:this.toggleSideBar();break}};refreshComponent=()=>{this.setState({reloadKey:this.state.reloadKey+1})};itemClicked=(e,t,s=[],i="")=>{const n=ce(e.uid,t),r=ce(e.guid),{IS_OWNER:h}=ve(),d=t===o.CometChat.ACTION_TYPE.TYPE_GROUP?r:n;this.props.isFromUniversalMessaging?window.history.replaceState({...window.history.state,prefilledMessage:this.props.prefilledMessage},""):this.props.navigate(`/${h?"owners":"renters"}/messages/${d}?tab=individual`),this.contextProviderRef.setTypeAndItem(t,e),this.contextProviderRef.setTagsAndConversationId(s,i),this.toggleSideBar()};actionHandler=(e,t,s,...i)=>{switch(e){case m.TOGGLE_SIDEBAR:this.toggleSideBar();break;case b:case f:case E:this.groupUpdated(e,t,s,...i);break}};toggleSideBar=()=>{const e=this.state.sidebarview;this.setState({sidebarview:!e})};handleTabChange=e=>{this.setState({activeTab:e})};groupUpdated=(e,t,s,i)=>{switch(e){case E:case f:{this.contextProviderRef.state.type===o.CometChat.ACTION_TYPE.TYPE_GROUP&&this.contextProviderRef.state.item.guid===s.guid&&i.user.uid===this.loggedInUser.uid&&(this.contextProviderRef.setItem({}),this.contextProviderRef.setType(""));break}case b:{if(this.contextProviderRef.state.type===o.CometChat.ACTION_TYPE.TYPE_GROUP&&this.contextProviderRef.state.item.guid===s.guid&&i.user.uid===this.loggedInUser.uid){const n=Object.assign({},this.contextProviderRef.state.item,{scope:i.scope});this.contextProviderRef.setItem(n),this.contextProviderRef.setType(o.CometChat.ACTION_TYPE.TYPE_GROUP)}break}}};render(){const e=a(fe,{key:`${this.state.reloadKey}_${this?.contextProviderRef?.state?.item?.uid}`,theme:this.props.theme,lang:this.props.lang,_parent:"unified",actionGenerated:this.actionHandler,activeTab:this.state.activeTab,tags:this.contextProviderRef?.state?.tags,onArchiveSuccess:this.refreshComponent,isFromUniversalMessaging:this.props.isFromUniversalMessaging});return a(te,{ref:t=>this.contextProviderRef=t,user:this.props.chatWithUser,group:this.props.chatWithGroup,language:this.props.lang},a("div",{key:this.state.reloadKey,css:Kt({...this.props,isFromUniversalMessaging:this.props.isFromUniversalMessaging}),className:"cometchat cometchat--unified",style:{height:this.props.isFromUniversalMessaging?"100%":void 0},dir:c.getDirection(this.props.lang)},a("div",{css:Jt(this.state,{...this.props,isFromUniversalMessaging:this.props.isFromUniversalMessaging}),className:"unified__sidebar"},a(ae,{ref:t=>this.navBarRef=t,theme:this.props.theme,actionGenerated:this.navBarAction,refreshComponent:this.refreshComponent,onTabChange:this.handleTabChange,isFromUniversalMessaging:this.props.isFromUniversalMessaging,initialChatId:this.props.initialChatId})),a("div",{css:Qt(this.state,{...this.props,isFromUniversalMessaging:this.props.isFromUniversalMessaging}),className:"unified__main"},e),a(be,{theme:this.props.theme,lang:this.props.lang,actionGenerated:this.actionHandler}),a(Te,{theme:this.props.theme,lang:this.props.lang,actionGenerated:this.actionHandler})))}}re.defaultProps={lang:c.getDefaultLanguage(),theme:v,chatWithUser:"",chatWithGroup:""};re.propTypes={lang:g.string,theme:g.object,chatWithUser:g.string,chatWithGroup:g.string};const hs=l=>{const{receiverUID:e}=Oe(),t=Ae();return a(re,{...l,receiverUID:e,navigate:t})};export{hs as CometChatUI};
//# sourceMappingURL=index-DEryBBf5.js.map
