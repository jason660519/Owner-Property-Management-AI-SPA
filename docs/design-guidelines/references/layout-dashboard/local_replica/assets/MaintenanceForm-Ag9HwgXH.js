import{r as C,G as te,j as e,k as h,a4 as se,a9 as O,as as w,ai as re,F as m,W as S,I as F,a8 as v,av as ie,a3 as oe,a5 as le,P as s}from"./TownhouseColor--VjQBVqd.js";import{bZ as ce,b_ as de,b$ as me,b3 as pe,aL as ue,bi as he,c0 as B,h as R,o as u,c1 as be,l as A,b8 as E,b6 as H,c2 as ge,n as k,c3 as xe,c4 as je,aK as Ne,aM as fe}from"./main-dumNSXg9.js";import{b as ye}from"./buildLeasesDropdownOptions-xsmjGLzP.js";import{i as Pe}from"./isNotEmptyArray-BVqQVndV.js";const _e="UZP6Q",Te="mI3dw",Ce="agHBt",Se="_0sKTe",Fe="_65RR0",ve="S8yjc",Me="S1Sla",We="osI4Y",Le="ocA0p",qe="Cqr5C",Ie="lQ4HZ",De="odCne",Oe="bIH4m",we="bWUKN",Be="TZdDQ",Re="h6xVS",Ae="EoNW4",Ee="OtiuL",He="d2w1P",ke="GYaCK",Ue="V0BoZ",n={card:_e,title:Te,subTitle:Ce,submit:Se,issueDescription:Fe,labelBottomMargin:ve,fieldWithMargin:Me,media:We,description:Le,iconTooltip:qe,labelWithTooltip:Ie,emergencyBanner:De,emergencyPhone:Oe,phoneHint:we,dropzone:Be,uploadLabel:Re,uploadIconWrapper:Ae,preferredTimeRadiosContainer:Ee,maintenancePropertyDropdown:He,schedulingSectionHeader:ke,iconWithBackground:Ue},ze=(c,r)=>r?"Edit Maintenance Request":c?"Submit a Maintenance Request":"Create Maintenance Request",Ve=(c,r)=>r?"Update the details of your maintenance request.":c?"Let your landlord know about any issues that need attention.":"Create a new maintenance request for your property.",Ze=c=>c?"Save Changes":"Submit Request",Ge=({className:c,isRenter:r,isEdit:d,onPropertyChange:M,initialValues:x={},onSubmit:W,leases:U,properties:f,listing:p,isLoading:z,maintenancePlusActive:V,mainApproverPhone:L,renterPhone:Z,renterId:G,isAutopilot:y,hideHeader:K=!1,noCard:X=!1})=>{const[Y,P]=C.useState(!1),[j,$]=C.useState(d?p.id:x?.property_id||null),_=!!f,q=r&&y,b=!r&&U.filter(t=>t.status!=="PAST"&&t.listing_id===j),Q=t=>{const l={value:"NONE",label:"No Tenant"};if(!t)return[l];const a=b.find(i=>i.id===t)?.renters||[];return[l,...a.map(i=>({value:i.id,label:`${i.first_name} ${i.last_name}`}))]},I=(t,l)=>!t||!l?null:b.find(i=>i.id===t)?.renters.find(i=>i.id===l),J=C.useCallback(async t=>{P(!0);const l=await Promise.all(t.map(async o=>{const a=await ce({filename:o.path,listing_id:p?.id||j}),i=te(a,"attachments[0].s3Params");return await de(i.url,o),i}));return P(!1),l},[P,j]);let g=d?x?.renter_id:null,N=d?x?.contact_phone_number:"";r&&!d?(N=Z||"",g=G):!r&&d&&!g&&(N=L||"",g="NONE");const D=e.jsxs(e.Fragment,{children:[!K&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:h(n.title),children:ze(r,d)}),e.jsx("p",{className:h(n.subTitle),children:Ve(r,d)})]}),e.jsx(se,{onSubmit:({renter_id:t,contact_phone_number:l,...o})=>W(t==="NONE"||!t?o:{...o,renter_id:t,contact_phone_number:l}),initialValues:{...x,...p?me(p):{},...N?{contact_phone_number:N}:{},...g?{renter_id:g}:{}},subscription:{submitting:!0,values:!0},mutators:{setValue:([t,l],o,{changeValue:a})=>{a(o,t,()=>l)}},children:({handleSubmit:t,submitting:l,form:o})=>e.jsxs("form",{onSubmit:t,className:h(n.container,c),children:[e.jsx(pe,{}),e.jsx(ue,{name:"lease_id",children:()=>{o.change("renter_id",null)}}),!r&&(f||p)&&e.jsx(he,{id:"property",className:n.maintenancePropertyDropdown,properties:_?f:[p?.root_listing||p],lockPreSelectedFields:!_,onListingChange:a=>{$(a),M&&M(a)},allowParentSelection:!0,required:!0,labelProps:{required:!0}}),(!_||j)&&e.jsxs(e.Fragment,{children:[!r&&e.jsxs(e.Fragment,{children:[b&&b.length>0&&e.jsx(B,{name:"lease_id",label:"Lease",labelProps:{hint:"(Optional)"},options:ye(b),isClearable:!0,className:n.fieldWithMargin}),y&&e.jsx(R,{type:"purple",icon:"lightning-circled",className:n.emergencyBanner,children:e.jsxs(O,{children:[e.jsx(w,{weight:"bold",color:"text",children:"Emergencies:"})," ","If this request is an emergency, please call our Repairs Team at"," ",e.jsx("a",{href:"tel:4156695398",children:e.jsx("span",{className:n.emergencyPhone,children:"(415) 669-5398"})}),"."]})}),V&&e.jsx(re,{subscription:{values:!0},children:({values:a})=>{const i=Q(a.lease_id);if(i.length===0)return null;const ee=a.renter_id!=="NONE"?I(a.lease_id,a.renter_id):null;return e.jsxs(e.Fragment,{children:[e.jsx(m,{label:e.jsxs(e.Fragment,{children:["Tenant Contact"," ",e.jsx(S,{className:n.iconTooltip,tip:e.jsx("span",{children:"Pick the right contact. Choose 'No Tenant' if it's you. To see your tenants, select a Lease above."})})]}),labelProps:{className:n.labelWithTooltip},component:be,name:"renter_id",id:"renter_id",className:n.fieldWithMargin,options:i,onChange:ne=>{const T=ne.target.value;if(o.mutators.setValue("renter_id",T),T==="NONE")o.mutators.setValue("contact_phone_number",L||"");else{const ae=I(a.lease_id,T);o.mutators.setValue("contact_phone_number",ae?.telephone||"")}},validate:u,empty:!0}),a.renter_id&&e.jsx(m,{label:e.jsxs(e.Fragment,{children:["Contact Phone Number"," ",e.jsx(S,{className:n.iconTooltip,tip:e.jsx("span",{children:"Only tenants can update their phone number. You can update yours in Settings."})})]}),labelProps:{className:n.labelWithTooltip},component:E,name:"contact_phone_number",id:"contact_phone_number",className:n.fieldWithMargin,validate:A(u,H),disabled:a.renter_id==="NONE"||!!ee?.telephone})]})}})]}),!r&&e.jsxs("div",{className:n.schedulingSectionHeader,children:[e.jsx("div",{className:n.iconWithBackground,children:e.jsx(F,{name:"maintenance",size:"xl"})}),e.jsx(v,{children:"Details"})]}),r&&y&&e.jsx(R,{type:"purple",icon:"lightning-circled",className:n.emergencyBanner,children:e.jsxs(O,{children:[e.jsx(w,{weight:"bold",color:"text",children:"Emergencies:"})," ","If this request is an emergency, please call our Repairs Team at"," ",e.jsx("a",{href:"tel:4156695398",children:e.jsx("span",{className:n.emergencyPhone,children:"(415) 669-5398"})}),"."]})}),r&&e.jsxs("div",{className:n.schedulingSectionHeader,children:[e.jsx("div",{className:n.iconWithBackground,children:e.jsx(F,{name:"maintenance",size:"xl"})}),e.jsx(v,{children:"Details"})]}),e.jsx(B,{name:"category",label:"Category",options:ge,isClearable:!0,className:n.fieldWithMargin,validate:u,labelProps:{required:!0}}),e.jsx(m,{label:"Title",component:k,name:"title",id:"issue_title",className:h(n.issueTitle,n.fieldWithMargin),maxLength:50,help:(a="")=>`${a.length} / 50 characters used`,hint:e.jsx("i",{className:n.issueDescription,children:'e.g. "Leaky Kitchen Faucet"'}),validate:u,labelProps:{required:!0}}),e.jsx(m,{label:"Description",component:k,name:"description",id:"description",className:n.description,inputProps:{as:"textarea"},labelProps:{required:!0,sublabel:"Add as much detail as possible, including the specific location and any troubleshooting you've already attempted."},validate:u}),e.jsxs("div",{className:n.media,children:[e.jsx(ie,{required:q,htmlFor:"attachments",sublabel:"Upload clear photos of the issue.",className:n.photoLabel,children:"Photos"}),e.jsx(m,{component:xe,name:"attachments"}),e.jsx(m,{component:je,uploadFiles:J,accept:"image/*",name:"attachments",id:"attachments",icon:()=>e.jsx("div",{className:n.uploadIconWrapper,children:e.jsx(oe,{name:"upload",size:"md"})}),dropzoneClassName:n.dropzone,dropzoneLabel:e.jsxs("span",{className:n.uploadLabel,children:["Click or drag to upload"," ",e.jsx(S,{className:n.iconTooltip,tip:e.jsx("span",{children:"Files must be â‰¤20MB and one of these file types: CSV, DOCX, JPG, PNG, PDF, TXT, XLSX, or ZIP."})})]}),validate:q?Pe("At least one photo is required."):void 0})]}),e.jsxs("div",{className:n.schedulingSection,children:[e.jsxs("div",{className:n.schedulingSectionHeader,children:[e.jsx("div",{className:n.iconWithBackground,children:e.jsx(F,{name:"calendar",size:"xl"})}),e.jsx(v,{children:"Scheduling"})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(m,{label:"Phone number",component:E,name:"contact_phone_number",id:"contact_phone_number",className:n.fieldWithMargin,labelProps:{required:!0},validate:A(u,H)}),e.jsx("p",{className:n.phoneHint,children:"This updates your account phone number."})]}),e.jsx(m,{label:"Preferred time to enter",component:Ne,name:"preferred_time",id:"preferred_time",className:h(n.fieldWithMargin,n.labelBottomMargin),radiosContainerClassName:n.preferredTimeRadiosContainer,labelProps:{required:!0},options:[{value:"ANYTIME",label:"Anytime"},{value:"COORDINATE",label:"Coordinate a time first"}],validate:u})]}),e.jsx(le,{className:n.submit,type:"submit",loading:l,id:"request_submit",disabled:Y||z,children:Ze(d)})]})]})})]});return X?D:e.jsx(fe,{className:h(n.card,c),children:D})};Ge.propTypes={className:s.string,isRenter:s.bool,isEdit:s.bool,onPropertyChange:s.func,leases:s.array,initialValues:s.object,onSubmit:s.func,properties:s.array,listing:s.object,isLoading:s.bool,maintenancePlusActive:s.bool,mainApproverPhone:s.string,renterPhone:s.string,renterId:s.string,isAutopilot:s.bool,hideHeader:s.bool,noCard:s.bool};export{Ge as M};
//# sourceMappingURL=MaintenanceForm-Ag9HwgXH.js.map
