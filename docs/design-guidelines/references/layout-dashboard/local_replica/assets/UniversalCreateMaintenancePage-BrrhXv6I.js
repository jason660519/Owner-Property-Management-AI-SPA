import{Q as T,b as U,r,G as o,v as B,E as D,j as s,L as F,k as c,s as V,V as $,P as R}from"./TownhouseColor--VjQBVqd.js";import{t as G,be as W,bf as Y,w as z,bD as H,ar as J}from"./main-dumNSXg9.js";import{M as K}from"./MaintenanceForm-Ag9HwgXH.js";import{M as X}from"./MaintenanceRequestSuccessCard-BA8a33lM.js";import{u as Z}from"./useLeasesWithRenters-BVXQPTBU.js";import{_ as ee}from"./createMaintenanceRequest-LYuxsy1P.js";import{g as se}from"./getListingAutopilotStatus-DCM8MU3f.js";import"./buildLeasesDropdownOptions-xsmjGLzP.js";import"./isNotEmptyArray-BVqQVndV.js";const te="-oB-B",ne="QPR4w",l={container:te,back:ne},L=({className:u})=>{const q=U(),m=new URLSearchParams(q.search),i=m.get("property_id"),d=m.get("lease_id"),[a,b]=r.useState(i||null),[v,P]=r.useState(!1),[p,S]=r.useState({maintenanceRequestId:null,finalListingId:null}),{user:t,loading:x}=G({polling:!1}),I=o(t,"maintenance_request_management_settings.approvers[0].phone",t?.telephone),{maintenance_plus_subscription_subscribed:M}=t||{},{leases:y=[],loading:E}=Z({},!1),{listings:g,loading:j}=W({variables:{mode:Y.ROOTS_ONLY}}),[w]=B(ee,{refetchQueries:[{query:z,variables:{id:a}},{query:D}],awaitRefetchQueries:!0,update:e=>{H(["maintenanceRequests","leases","tenants","renterProfile"],e)}}),A=o(t,"maintenance_plus_active_experiment",!1),k=t?.maintenance_request_management_settings||!1,N=A&&!!k;if(j||E||x)return s.jsx(F,{loading:!0});const _=se({selectedListingId:a,listing:null,properties:g});if(v)return s.jsx("div",{className:c(l.container,u),children:s.jsx(X,{maintenanceRequestId:p.maintenanceRequestId,listingId:p.finalListingId,isAutopilot:_,isRenter:!1})});const O=async e=>{V("submit_request clicked",{location:"Maintenance Request"}),e.renterId==="NONE"&&(delete e.renterId,delete e.contact_phone_number);const C={listing_id:a,...e,attachments:(e.attachments||[]).map(n=>({id:n.id}))};try{const{data:n}=await w({variables:{...C}}),{createMaintenanceRequest:{maintenance_request:h}}=n;S({maintenanceRequestId:h.id,finalListingId:a}),P(!0)}catch(n){const Q=(o(n,"graphQLErrors[0]")||{}).message||"Something went wrong";return window.scrollTo(0,0),{[$]:Q}}},f=i&&d?{property_id:i,lease_id:d}:void 0;return s.jsxs("div",{className:c(l.container,u),children:[s.jsx("div",{className:c(l.back),children:s.jsx(J,{})}),s.jsx(K,{onSubmit:O,onPropertyChange:b,properties:g,...f&&{initialValues:f},leases:y,maintenancePlusActive:M||N,mainApproverPhone:I||t?.telephone,isAutopilot:_})]})};L.propTypes={className:R.string,match:R.object};const pe=T(L);export{pe as default};
//# sourceMappingURL=UniversalCreateMaintenancePage-BrrhXv6I.js.map
