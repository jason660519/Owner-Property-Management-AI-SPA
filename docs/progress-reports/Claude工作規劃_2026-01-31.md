# 今日工作規劃 - Web App 開發推進計劃

> **創建日期**: 2026-01-31  
> **創建者**: Project Team  
> **最後修改**: 2026-01-31  
> **修改者**: Project Team  
> **版本**: 1.0  
> **文件類型**: 進度報告

---


> **規劃日期**: 2026-01-31  
> **規劃者**: Claude Sonnet 4.5  
> **專案名稱**: Owner Property Management AI SPA  
> **當前進度**: Web App 開發進度 ~15%，需加速推進  
> **參考文件**: `Owner Property Management AI Project_backup_20260130_214516.xlsx` - "Expo WebApp+Mobile App功能需求表"

---

## 📊 現況評估

### 當前已完成項目 ✅
1. **公司官網首頁 (http://localhost:8081/)**
   - ✅ Hero Section - 主視覺區塊
   - ✅ Features Section - 6大核心功能展示
   - ✅ Navigation Bar - 導航列
   - ✅ CTA Sections - 行動呼籲區塊
   - ✅ Footer - 頁腳
   - ✅ 響應式設計 (Desktop/Tablet/Mobile)
   - ✅ SEO 優化基礎設定

### 目前缺少的關鍵功能 ❌
根據 Excel「Expo WebApp+Mobile App功能需求表」，**所有 A 級優先功能皆處於 "Not Started" 狀態**：

#### A 級優先（急迫性最高）
1. **Admin_Dashboard_001-013** - Super Admin 儀表板與管理功能（13項）
2. **Landlord_Dashboard_001-015** - 房東儀表板與核心功能（15項）
3. **Universal Interface_05** - 行事曆管理（所有角色共用）

#### 技術架構缺口
- ❌ 無任何認證登入頁面
- ❌ 無儀表板路由結構
- ❌ 無角色權限管理 (RBAC)
- ❌ 無 Supabase 整合實作
- ❌ 無資料庫查詢與展示
- ❌ 無檔案上傳功能

---

## 🎯 今日工作目標

### 核心策略
**採用「垂直切片」開發法（Vertical Slice Architecture）**，優先完成一條完整的用戶流程，而非橫向完成所有頁面框架。

### 選定優先流程：房東登入與物件管理
**理由**：
1. 房東是本平台的核心用戶
2. 物件管理是最高價值功能
3. 包含完整的 CRUD 操作，可建立技術範本
4. 後續其他功能可複用此架構

---

## 📋 今日具體工作項目

### 階段一：基礎架構搭建（預計 2-3 小時）

#### 1.1 路由結構建立
```
apps/web/app/
├── (auth)/                         # 認證相關路由組
│   ├── login/
│   │   └── page.tsx               # 通用登入頁
│   ├── register/
│   │   └── page.tsx               # 通用註冊頁
│   └── layout.tsx                 # 認證頁面共用布局
│
├── (dashboard)/                    # 儀表板路由組
│   ├── landlord/                  # 房東儀表板
│   │   ├── dashboard/
│   │   │   └── page.tsx          # 儀表板首頁
│   │   ├── properties/
│   │   │   ├── page.tsx          # 物件列表
│   │   │   ├── add/
│   │   │   │   └── page.tsx      # 新增物件
│   │   │   └── [id]/
│   │   │       └── page.tsx      # 物件詳情
│   │   └── layout.tsx            # 房東儀表板布局
│   │
│   ├── super-admin/               # 超級管理員儀表板
│   │   ├── dashboard/
│   │   │   └── page.tsx
│   │   └── layout.tsx
│   │
│   └── layout.tsx                 # 所有儀表板共用布局
│
└── page.tsx                       # 首頁（已完成）
```

**任務清單**：
- [ ] 創建 `(auth)` 路由組及布局
- [ ] 創建 `(dashboard)` 路由組及布局
- [ ] 創建 `landlord` 子路由結構
- [ ] 創建 `super-admin` 子路由結構

---

#### 1.2 Supabase 認證整合

**實作內容**：
```typescript
// lib/supabase/client.ts
- [ ] 設置 Supabase Client
- [ ] 配置環境變數 (.env.local)

// lib/supabase/auth.ts
- [ ] signInWithPassword() - Email/密碼登入
- [ ] signUp() - 註冊
- [ ] signOut() - 登出
- [ ] getSession() - 取得當前 session
- [ ] onAuthStateChange() - 監聽認證狀態

// middleware.ts
- [ ] 保護需要認證的路由
- [ ] 角色權限檢查中介層
```

**對應需求**：
- ✅ Landlord_Dashboard_007 - 房東登入頁面
- ✅ Admin_Dashboard_003 - 超級管理員登入功能

---

#### 1.3 共用 UI 組件庫

**創建核心組件**：
```
components/ui/
├── Button.tsx                     # 按鈕組件
├── Input.tsx                      # 輸入框組件
├── Card.tsx                       # 卡片組件
├── Table.tsx                      # 表格組件
├── Modal.tsx                      # 對話框組件
├── Form/                          # 表單組件集
│   ├── FormField.tsx
│   ├── FormLabel.tsx
│   └── FormError.tsx
└── Dashboard/                     # 儀表板專用組件
    ├── Sidebar.tsx                # 側邊欄
    ├── Header.tsx                 # 頂部導航
    └── StatCard.tsx               # 數據卡片
```

**任務清單**：
- [ ] 安裝依賴：`react-hook-form`, `zod`, `@hookform/resolvers`
- [ ] 創建 Form 組件（整合 react-hook-form + zod）
- [ ] 創建 Button 變體（primary, secondary, outline, ghost）
- [ ] 創建 Input 組件（支援驗證錯誤顯示）
- [ ] 創建 Sidebar 組件（含路由高亮）
- [ ] 創建 Header 組件（含用戶下拉選單）

---

### 階段二：房東登入流程（預計 1.5-2 小時）

#### 2.1 登入頁面實作

**頁面**: `app/(auth)/login/page.tsx`

**功能需求** (對應 Landlord_Dashboard_007):
- [ ] Email + 密碼登入表單
- [ ] 社群帳號登入按鈕（Google, Facebook, Apple）
- [ ] "記住我"選項
- [ ] "忘記密碼"連結
- [ ] 表單驗證（Email 格式、密碼最少 8 字元）
- [ ] 錯誤訊息顯示
- [ ] 登入成功後導向 `/landlord/dashboard`

**技術實作**：
```typescript
- [ ] 使用 react-hook-form + zod schema 驗證
- [ ] Supabase Auth signInWithPassword()
- [ ] OAuth 整合 (Google/Facebook/Apple)
- [ ] AsyncStorage 記住登入狀態
- [ ] 錯誤處理與友善提示
```

**驗收標準**：
- ✅ Email+密碼登入成功
- ✅ 各社群帳號登入成功
- ✅ 記住登入狀態（AsyncStorage）
- ✅ 失敗顯示錯誤訊息
- ✅ 導向 Landlord Dashboard

---

#### 2.2 註冊頁面實作

**頁面**: `app/(auth)/register/page.tsx`

**功能需求**:
- [ ] Email + 密碼註冊表單
- [ ] 密碼強度指示器
- [ ] 服務條款同意勾選
- [ ] Email 驗證流程
- [ ] 自動登入並導向儀表板

**驗收標準**：
- ✅ 新用戶註冊成功
- ✅ Email 驗證信發送
- ✅ 密碼強度檢查≥8字元含大小寫+數字
- ✅ 註冊成功自動登入

---

### 階段三：房東儀表板首頁（預計 2-3 小時）

#### 3.1 儀表板布局

**頁面**: `app/(dashboard)/landlord/layout.tsx`

**實作內容**：
- [ ] 側邊欄導航（Sidebar）
  - Dashboard 總覽
  - 我的物件
  - 客戶管理
  - 預約管理
  - 財務報表
  - 設定
- [ ] 頂部導航（Header）
  - 麵包屑導航
  - 通知圖示
  - 用戶頭像與下拉選單
- [ ] 主內容區域
- [ ] 響應式設計（手機版折疊選單）

---

#### 3.2 儀表板首頁

**頁面**: `app/(dashboard)/landlord/dashboard/page.tsx`

**功能需求** (對應 Landlord_Dashboard_001):
- [ ] KPI 數據卡片
  - 物件總數
  - 租金收入（本月/本年）
  - 空置率
  - 待處理事項數量
- [ ] 最近活動時間軸
- [ ] 快速操作選單
  - 新增物件
  - 查看預約
  - 財務報表
- [ ] 物件狀態圖表（圓餅圖/長條圖）

**Supabase 查詢**：
```sql
- [ ] 查詢該房東的所有物件（Property_Sales + Property_Rentals）
- [ ] 計算總租金收入（Rental_Ledger）
- [ ] 計算空置率
- [ ] 查詢最近活動（Viewing_Appointments_Tenant）
```

**驗收標準**：
- ✅ 頁面載入≤2s
- ✅ 所有 KPI 正確顯示即時資料
- ✅ 僅該房東的資料（RLS 驗證）
- ✅ 響應式佈局（Desktop/Tablet/Mobile）

---

### 階段四：物件管理功能（預計 3-4 小時）

#### 4.1 物件列表頁

**頁面**: `app/(dashboard)/landlord/properties/page.tsx`

**功能需求**：
- [ ] 物件卡片展示（Grid View）
  - 主圖片
  - 地址
  - 類型（出租/出售）
  - 價格
  - 狀態標籤
- [ ] 搜尋與篩選
  - 關鍵字搜尋
  - 類型篩選（出租/出售）
  - 狀態篩選（已出租/空置/已售出）
- [ ] 排序功能
  - 最新發布
  - 價格高低
  - 地址
- [ ] 分頁功能（每頁 12 筆）
- [ ] 新增物件按鈕（導向新增頁）

**Supabase 查詢**：
```sql
- [ ] 查詢房東的所有物件（含照片）
- [ ] 實作全文搜尋（Elasticsearch 或 PostgreSQL FTS）
- [ ] 篩選與排序邏輯
```

---

#### 4.2 新增物件頁面（手動輸入）

**頁面**: `app/(dashboard)/landlord/properties/add/page.tsx`

**功能需求** (對應 Landlord_Dashboard_002):
- [ ] 多步驟表單（Multi-step Form）
  - 步驟1: 基本資料（地址、類型、價格）
  - 步驟2: 權狀資料（所有權人、面積、建號地號）
  - 步驟3: 面積換算（m² ↔ 坪數雙向綁定）
  - 步驟4: 照片上傳
  - 步驟5: 預覽與確認
- [ ] 單位轉換功能
  - 平方公尺 → 坪數（1 m² = 0.3025 坪）
  - 即時雙向換算
  - 精度≤0.01
- [ ] 照片上傳
  - 支援 JPG/PNG/HEIC
  - 批次上傳≤10MB
  - 拖曳排序
  - 設定主圖
- [ ] 草稿自動儲存（每 30 秒）
- [ ] 即時欄位驗證

**Supabase 整合**：
```typescript
- [ ] 上傳照片至 Supabase Storage
- [ ] 寫入 Property_Sales 或 Property_Rentals
- [ ] 關聯照片記錄至 Property_Photos
- [ ] 草稿功能（localStorage 或 DB）
```

**驗收標準**：
- ✅ 單頁多 sheet 格式輸入方式（方便上/下頁切換/儲存草稿）
- ✅ 必填欄位驗證：所有權人姓名、聯絡地址、主建物面積
- ✅ 面積欄位支援 m²/坪 即時切換，換算精度≤0.01 誤差
- ✅ 草稿自動儲存（每 30 秒）
- ✅ 照片上傳≤10MB，支援 JPG/PNG/HEIC
- ✅ 儲存成功導向物件詳情頁

---

#### 4.3 物件詳情頁

**頁面**: `app/(dashboard)/landlord/properties/[id]/page.tsx`

**功能需求** (對應 Landlord_Dashboard_036):
- [ ] 顯示物件所有基本資訊
- [ ] 照片 Gallery（支援滑動/放大）
- [ ] 地圖定位（Google Maps 或 Mapbox）
- [ ] 顯示租金/售價
- [ ] 編輯/刪除按鈕
- [ ] 分享功能（生成公開連結）

**Supabase 查詢**：
```sql
- [ ] 查詢單一物件完整資料
- [ ] JOIN Property_Photos 取得所有照片
- [ ] 權限檢查（僅該房東可編輯）
```

---

## 🛠️ 技術實作細節

### 環境變數設置

**檔案**: `apps/web/.env.local`

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=<your-anon-key>

# OAuth (後續設定)
NEXT_PUBLIC_GOOGLE_CLIENT_ID=
NEXT_PUBLIC_FACEBOOK_APP_ID=
NEXT_PUBLIC_APPLE_CLIENT_ID=
```

---

### 套件安裝清單

```bash
cd apps/web

# 表單處理
npm install react-hook-form zod @hookform/resolvers

# Supabase
npm install @supabase/supabase-js @supabase/auth-helpers-nextjs

# UI 增強
npm install framer-motion          # 已安裝
npm install react-dropzone         # 檔案上傳
npm install react-image-gallery    # 照片展示

# 圖表
npm install recharts              # 統計圖表

# 地圖
npm install @vis.gl/react-google-maps  # Google Maps

# 工具
npm install date-fns              # 日期處理
npm install numeral               # 數字格式化
```

---

### Supabase RLS 政策設置

**執行 SQL** (Supabase Studio):

```sql
-- 房東只能查看/編輯自己的物件
CREATE POLICY "Landlords can view own properties"
ON public."Property_Sales"
FOR SELECT
TO authenticated
USING (auth.uid() = landlord_id);

CREATE POLICY "Landlords can insert own properties"
ON public."Property_Sales"
FOR INSERT
TO authenticated
WITH CHECK (auth.uid() = landlord_id);

CREATE POLICY "Landlords can update own properties"
ON public."Property_Sales"
FOR UPDATE
TO authenticated
USING (auth.uid() = landlord_id);

-- Property_Rentals 同樣設定
-- Property_Photos 同樣設定
```

---

## 📊 今日預期交付成果

### 完成項目（預計下班前）
1. ✅ **路由架構** - 完整的認證與儀表板路由結構
2. ✅ **登入/註冊頁** - 功能完整可用
3. ✅ **房東儀表板首頁** - 含即時數據展示
4. ✅ **物件列表頁** - 含搜尋/篩選/分頁
5. ✅ **新增物件頁** - 多步驟表單與照片上傳
6. ✅ **物件詳情頁** - 完整資訊展示
7. ✅ **共用 UI 組件** - 至少 8 個基礎組件

### 測試與驗證
- [ ] 所有頁面可正常訪問
- [ ] 登入/登出流程完整
- [ ] 新增物件完整流程（含照片上傳）
- [ ] RLS 權限正確（房東只看到自己的物件）
- [ ] 響應式設計正常（手機/平板/桌面）
- [ ] 無 Console 錯誤

---

## 🎯 明日工作預覽（2026-02-01）

### 優先項目
1. **OCR 掃描權狀功能** (Landlord_Dashboard_003)
   - 整合 Python OCR 服務
   - PDF/圖片上傳
   - 自動欄位回填
   
2. **VLM 智能解析功能** (Landlord_Dashboard_004)
   - 整合 Claude 3.5 Sonnet API
   - 非結構化文件理解
   - 智能推理填入表單

3. **照片管理功能** (Landlord_Dashboard_005)
   - 批次上傳≤20張
   - 拖曳排序
   - 自動壓縮≤2MB

4. **客戶管理模組** (Landlord_Dashboard_010-013)
   - Details/Grid/List 三種視圖
   - 新增客戶功能

---

## 📈 進度追蹤指標

### 本日目標 KPI
- **功能完成度**: 從 15% 提升至 35%
- **路由覆蓋率**: 新增 10+ 個頁面
- **組件數量**: 新增 15+ 個 UI 組件
- **Supabase 整合**: 5+ 個資料表查詢/寫入
- **測試通過率**: 100%

### 本週目標（2026-01-31 ~ 2026-02-06）
- **功能完成度**: 達到 50%
- **A 級優先功能**: 完成 50%（約 14/28 項）
- **房東核心流程**: 100% 可用（登入→物件管理→客戶管理→預約）

---

## 🚀 開發環境檢查清單

### 啟動前確認
- [ ] Docker Desktop 運行中
- [ ] Supabase 本地服務啟動 (`supabase start`)
- [ ] 環境變數已設置 (`.env.local`)
- [ ] 依賴已安裝 (`npm install`)

### 開發工具
- [ ] VS Code 擴充套件：
  - ES7+ React/Redux/React-Native snippets
  - Tailwind CSS IntelliSense
  - Prettier - Code formatter
  - ESLint

---

## 📚 參考文件

### 專案內部文檔
- [產品概述](../產品概述及使用場景說明/產品概述.md)
- [設計規範](../專案架構說明/DESIGN.md)
- [技術棧說明](../專案架構說明/技術棧說明.md)
- [SDLC 進度報告](./SDLC開發進度表報告_2026-01-31.md)

### 外部資源
- [Next.js 15 文檔](https://nextjs.org/docs)
- [Supabase 文檔](https://supabase.com/docs)
- [React Hook Form](https://react-hook-form.com/)
- [Zod Schema Validation](https://zod.dev/)
- [Tailwind CSS](https://tailwindcss.com/docs)

---

## 💡 開發注意事項

### 程式碼品質
1. **TypeScript 嚴格模式** - 所有檔案必須型別安全
2. **ESLint 規則** - 自動修正格式問題
3. **組件命名** - PascalCase（React 組件）、kebab-case（檔案名）
4. **註解規範** - 複雜邏輯必須註解說明

### 效能優化
1. **圖片優化** - 使用 Next.js Image 組件
2. **動態載入** - 大組件使用 dynamic import
3. **資料快取** - Supabase 查詢結果適當快取
4. **分頁載入** - 避免一次載入過多資料

### 安全性
1. **XSS 防護** - 使用者輸入必須驗證與淨化
2. **CSRF 防護** - 使用 Supabase Auth token
3. **RLS 政策** - 所有資料表必須設置 RLS
4. **敏感資訊** - 不可在前端暴露 service_role key

---

## 📞 問題回報與協作

### 遇到問題時
1. 檢查 Console 錯誤訊息
2. 查看 Supabase Logs (`supabase logs`)
3. 參考相關文檔
4. 記錄問題於 GitHub Issues

### 每日結束前
1. Commit 當日程式碼
2. 更新進度報告
3. 標記待解決問題
4. 規劃明日工作

---

**版本記錄**:
- v1.0 - 2026-01-31 - 初版建立，涵蓋今日完整工作計劃
