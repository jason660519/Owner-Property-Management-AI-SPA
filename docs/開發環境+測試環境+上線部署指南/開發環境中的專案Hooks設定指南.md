# é–‹ç™¼ç’°å¢ƒä¸­çš„å°ˆæ¡ˆ Hooks è¨­å®šæŒ‡å—

> **å‰µå»ºæ—¥æœŸ**: 2026-01-30  
> **å‰µå»ºè€…**: Project Team  
> **æœ€å¾Œä¿®æ”¹**: 2026-01-30  
> **ä¿®æ”¹è€…**: Project Team  
> **ç‰ˆæœ¬**: 1.0  
> **æ–‡ä»¶é¡å‹**: é–‹ç™¼æŒ‡å—

---


## ğŸ“‹ æŒ‡å—æ¦‚è¿°

èº«ç‚ºè»Ÿé«”å·¥ç¨‹å¸«ï¼Œåœ¨ç¾ä»£é–‹ç™¼ç’°å¢ƒä¸­ï¼ŒHooks æ˜¯ç¢ºä¿ç¨‹å¼ç¢¼å“è³ªã€è‡ªå‹•åŒ–å·¥ä½œæµç¨‹å’Œç¶­è­·åœ˜éšŠå”ä½œçš„é‡è¦å·¥å…·ã€‚æœ¬æŒ‡å—å…¨é¢åˆ†æäº†ä¸‰ç¨®ä¸»è¦çš„ Hook è¨­å®šæ–¹æ³•ï¼š

- **AI å·¥å…· Hooks**ï¼šæœ€ä½³åŒ– AI è¼”åŠ©é–‹ç™¼é«”é©—
- **å‚³çµ± Git Hooks**ï¼šåŸºç¤çš„ç‰ˆæœ¬æ§åˆ¶è‡ªå‹•åŒ–
- **ç¾ä»£ Git Hooks (Husky)**ï¼šä¼æ¥­ç´šçš„é–‹ç™¼å·¥ä½œæµç¨‹ç®¡ç†

æœ¬æ–‡å°‡å¾è»Ÿé«”å·¥ç¨‹å¸«çš„è§’åº¦å‡ºç™¼ï¼Œè©³ç´°è©•ä¼°æ¯ç¨®æ–¹æ³•çš„å„ªç¼ºé»ï¼Œä¸¦æä¾›é¸æ“‡å»ºè­°ï¼Œå”åŠ©æ‚¨åœ¨å°ˆæ¡ˆä¸­åšå‡ºæœ€ä½³æ±ºç­–ã€‚

---

## ğŸ¯ è»Ÿé«”å·¥ç¨‹å¸«çš„ Hook é¸æ“‡æ¡†æ¶

### è©•ä¼°ç¶­åº¦

åœ¨é¸æ“‡ Hook è§£æ±ºæ–¹æ¡ˆæ™‚ï¼Œè»Ÿé«”å·¥ç¨‹å¸«éœ€è¦è€ƒæ…®ä»¥ä¸‹é—œéµå› ç´ ï¼š

1. **åœ˜éšŠè¦æ¨¡èˆ‡å”ä½œæ¨¡å¼**
2. **æŠ€è¡“æ£§è¤‡é›œåº¦**
3. **CI/CD æ•´åˆéœ€æ±‚**
4. **ç¶­è­·æˆæœ¬èˆ‡å­¸ç¿’æ›²ç·š**
5. **ç‰ˆæœ¬æ§åˆ¶èˆ‡å¯ç§»æ¤æ€§**
6. **ç”Ÿæ…‹ç³»çµ±æ”¯æ´**

### æ±ºç­–æµç¨‹

```
è­˜åˆ¥å°ˆæ¡ˆéœ€æ±‚
    â†“
è©•ä¼°åœ˜éšŠè¦æ¨¡
    â†“
åˆ†ææŠ€è¡“æ£§
    â†“
è€ƒæ…®ç¶­è­·æˆæœ¬
    â†“
é¸æ“‡æœ€åˆé©çš„æ–¹æ¡ˆ
```

---

## ğŸ” ä¸‰ç¨® Hook æ–¹æ³•è©³è§£

### 1ï¸âƒ£ AI å·¥å…· Hooks (å…¨åŸŸæœ€ä½³åŒ–å‹)

**å…¸å‹ä»£è¡¨**: Claude Code, GitHub Copilot CLI ç­‰ AI ç¨‹å¼è¨­è¨ˆåŠ©æ‰‹

#### æ ¸å¿ƒç‰¹æ€§

- **ä½œç”¨ç¯„åœ**: å…¨åŸŸ (é–‹ç™¼è€…å€‹äººç’°å¢ƒ)
- **è§¸ç™¼æ™‚æ©Ÿ**: AI å·¥å…·åŸ·è¡Œå‘½ä»¤æ™‚
- **å¸¸è¦‹çš„é…ç½®ä½ç½®**: ä½¿ç”¨è€…ä¸»ç›®éŒ„æˆ–å°ˆæ¡ˆç´šåˆ¥çš„ç›®éŒ„ (ä¾‹ï¼š`~/.config/`)ï¼Œè©³ç´°é…ç½®æ–‡ä»¶ä½ç½®ï¼Œä¸åŒçš„AI,IDEæœƒæœ‰æ‰€ä¸åŒçš„ä½ç½®ï¼

#### è»Ÿé«”å·¥ç¨‹å¸«è§€é»çš„è©•ä¼°

**âœ… å„ªå‹¢ï¼š**

- æå‡ AI å·¥å…·çš„åŸ·è¡Œæ•ˆç‡
- çµ±ä¸€åœ˜éšŠçš„é–‹ç™¼å·¥å…·ä½¿ç”¨è¦ç¯„
- æ¸›å°‘æ‰‹å‹•ç¨‹å¼ç¢¼å¯©æŸ¥çš„å·¥ä½œé‡
- å³æ™‚æä¾›é–‹ç™¼å»ºè­°

**âŒ å±€é™æ€§ï¼š**

- åƒ…åœ¨ AI è¼”åŠ©é–‹ç™¼æ™‚ç”Ÿæ•ˆ
- ä¾è³´ç‰¹å®š AI å·¥å…·çš„æ”¯æ´
- ç„¡æ³•æ¶µè“‹ç´”æ‰‹å‹•ç·¨ç¢¼å ´æ™¯
- é…ç½®ç›¸å°è¤‡é›œ

#### é©ç”¨å ´æ™¯

- AI é©…å‹•çš„é–‹ç™¼ç’°å¢ƒ
- å¤§å‹åœ˜éšŠéœ€è¦çµ±ä¸€é–‹ç™¼è¦ç¯„
- å¸Œæœ›æå‡ AI å·¥å…·ä½¿ç”¨æ•ˆç‡çš„å·¥ç¨‹å¸«

#### Claude Code é…ç½®å¯¦ä¾‹

ä»¥ä¸‹æ˜¯ Claude Code å…¨åŸŸé…ç½®çš„å¯¦éš›ç¯„ä¾‹ï¼š

**é…ç½®æ–‡ä»¶ä½ç½®**: `~/.config/claude-code/config.json`

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.config/claude-code/hooks/bash_command_validator.py"
          }
        ]
      }
    ]
  }
}
```

**å°æ‡‰çš„é©—è­‰æŒ‡ä»¤ç¢¼** (`~/.config/claude-code/hooks/bash_command_validator.py`):

```python
#!/usr/bin/env python3
"""
Claude Code Hook: Bash å‘½ä»¤é©—è­‰å™¨
==================================
æ­¤ Hook åœ¨ Bash å·¥å…·ä½¿ç”¨å‰é‹è¡Œï¼Œç”¨æ–¼é©—è­‰ bash å‘½ä»¤ã€‚
å»ºè­°å°‡ grep èª¿ç”¨æ”¹ç‚ºä½¿ç”¨ rgã€‚

è©³ç´°èªªæ˜è«‹åƒè€ƒ: https://docs.anthropic.com/en/docs/claude-code/hooks
"""

import json
import re
import sys

# å®šç¾©é©—è­‰è¦å‰‡ (regex pattern, message) å…ƒçµ„åˆ—è¡¨
_VALIDATION_RULES = [
    (
        r"^grep\b(?!.*\|)",
        "è«‹ä½¿ç”¨ 'rg' (ripgrep) æ›¿ä»£ 'grep' ä»¥ç²å¾—æ›´å¥½çš„æ•ˆèƒ½å’ŒåŠŸèƒ½",
    ),
    (
        r"^find\s+\S+\s+-name\b",
        "è«‹ä½¿ç”¨ 'rg --files | rg pattern' æˆ– 'rg --files -g pattern' æ›¿ä»£ 'find -name' ä»¥ç²å¾—æ›´å¥½çš„æ•ˆèƒ½",
    ),
]


def _validate_command(command: str) -> list[str]:
    issues = []
    for pattern, message in _VALIDATION_RULES:
        if re.search(pattern, command):
            issues.append(message)
    return issues


def main():
    try:
        input_data = json.load(sys.stdin)
    except json.JSONDecodeError as e:
        print(f"éŒ¯èª¤: ç„¡æ•ˆçš„ JSON è¼¸å…¥: {e}", file=sys.stderr)
        # é€€å‡ºä»£ç¢¼ 1 å‘ä½¿ç”¨è€…é¡¯ç¤º stderrï¼Œä½†ä¸å‘ Claude é¡¯ç¤º
        sys.exit(1)

    tool_name = input_data.get("tool_name", "")
    if tool_name != "Bash":
        sys.exit(0)

    tool_input = input_data.get("tool_input", {})
    command = tool_input.get("command", "")

    if not command:
        sys.exit(0)

    issues = _validate_command(command)
    if issues:
        for message in issues:
            print(f"â€¢ {message}", file=sys.stderr)
        # é€€å‡ºä»£ç¢¼ 2 é˜»æ­¢å·¥å…·èª¿ç”¨ä¸¦å‘ Claude é¡¯ç¤º stderr
        sys.exit(2)


if __name__ == "__main__":
    main()
```

**é…ç½®èªªæ˜**:

- **å…¨åŸŸç¯„åœ**: æ­¤é…ç½®é©ç”¨æ–¼æ‚¨é›»è…¦ä¸Šæ‰€æœ‰çš„ Claude Code å°ˆæ¡ˆ
- **è§¸ç™¼æ™‚æ©Ÿ**: ç•¶ Claude Code å˜—è©¦åŸ·è¡Œ Bash å‘½ä»¤æ™‚
- **é©—è­‰é‚è¼¯**: è‡ªå‹•æª¢æŸ¥ä¸¦å»ºè­°ä½¿ç”¨æ›´é«˜æ•ˆçš„å·¥å…·æ›¿ä»£å‚³çµ±å‘½ä»¤
- **éŒ¯èª¤è™•ç†**: ç™¼ç¾å•é¡Œæ™‚æœƒé˜»æ­¢å‘½ä»¤åŸ·è¡Œä¸¦é¡¯ç¤ºå»ºè­°

---

### 2ï¸âƒ£ å‚³çµ± Git Hooks (åŸºç¤å¯¦ç”¨å‹)

**ä½ç½®**: `.git/hooks/` ç›®éŒ„

#### æ ¸å¿ƒç‰¹æ€§

- **ä½œç”¨ç¯„åœ**: å°ˆæ¡ˆç´š
- **è§¸ç™¼æ™‚æ©Ÿ**: Git æ“ä½œæ™‚
- **é…ç½®æ–¹å¼**: Shell æŒ‡ä»¤ç¢¼

#### è»Ÿé«”å·¥ç¨‹å¸«è§€é»çš„è©•ä¼°

**âœ… å„ªå‹¢ï¼š**

- ç„¡é¡å¤–ä¾è³´ï¼ŒåŸ·è¡Œé€Ÿåº¦å¿«
- å®Œå…¨å¯æ§ï¼Œå¯è‡ªè¨‚ä»»ä½•é‚è¼¯
- é©ç”¨æ–¼å„ç¨®ç¨‹å¼èªè¨€å’Œç’°å¢ƒ
- å­¸ç¿’æˆæœ¬ä½ï¼Œå®¹æ˜“ç†è§£

**âŒ å±€é™æ€§ï¼š**

- ç„¡æ³•ç‰ˆæœ¬æ§åˆ¶ï¼Œåœ˜éšŠæˆå“¡éœ€æ‰‹å‹•é…ç½®
- ç¶­è­·å›°é›£ï¼Œå®¹æ˜“è¢«å¿½ç•¥
- ç¼ºä¹ç¾ä»£å·¥å…·éˆæ•´åˆ
- é™¤éŒ¯å’Œæ¸¬è©¦ç›¸å°è¤‡é›œ

#### é©ç”¨å ´æ™¯

- å€‹äººå°ˆæ¡ˆæˆ–å°å‹åœ˜éšŠ
- å°å¤–éƒ¨ä¾è³´æ•æ„Ÿçš„ç’°å¢ƒ
- ç°¡å–®çš„è‡ªå‹•åŒ–éœ€æ±‚

---

### 3ï¸âƒ£ ç¾ä»£ Git Hooks (Husky - ä¼æ¥­ç´šè§£æ±ºæ–¹æ¡ˆ)

**ä½ç½®**: `.husky/` ç›®éŒ„ (é€é Husky ç®¡ç†)

#### æ ¸å¿ƒç‰¹æ€§

- **ä½œç”¨ç¯„åœ**: å°ˆæ¡ˆç´š
- **è§¸ç™¼æ™‚æ©Ÿ**: Git æ“ä½œæ™‚
- **é…ç½®æ–¹å¼**: Node.js ç”Ÿæ…‹ç³»çµ±

#### è»Ÿé«”å·¥ç¨‹å¸«è§€é»çš„è©•ä¼°

**âœ… å„ªå‹¢ï¼š**

- å¯ç‰ˆæœ¬æ§åˆ¶ï¼Œåœ˜éšŠè‡ªå‹•åŒæ­¥
- è±å¯Œçš„ç”Ÿæ…‹ç³»çµ±å’Œå·¥å…·æ•´åˆ
- å„ªç§€çš„éŒ¯èª¤è™•ç†å’Œé™¤éŒ¯é«”é©—
- æ”¯æ´ç¾ä»£å‰ç«¯å·¥å…·éˆ
- è‡ªå‹•åŒ–å®‰è£å’Œé…ç½®

**âŒ å±€é™æ€§ï¼š**

- éœ€è¦ Node.js ç’°å¢ƒ
- å•Ÿå‹•æ™‚é–“ç›¸å°è¼ƒæ…¢
- å­¸ç¿’æ›²ç·šç¨é™¡å³­
- å°é Node.js å°ˆæ¡ˆä¸å¤ å‹å¥½

#### é©ç”¨å ´æ™¯

- ä¸­å¤§å‹åœ˜éšŠå”ä½œå°ˆæ¡ˆ
- ä½¿ç”¨ç¾ä»£å‰ç«¯æŠ€è¡“æ£§
- éœ€è¦è¤‡é›œå·¥ä½œæµç¨‹è‡ªå‹•åŒ–çš„å ´æ™¯
- é‡è¦–ç¨‹å¼ç¢¼å“è³ªå’Œåœ˜éšŠè¦ç¯„çš„ä¼æ¥­ç’°å¢ƒ

---

## ğŸ“Š è»Ÿé«”å·¥ç¨‹å¸«é¸æ“‡æŒ‡å—

### æ ¸å¿ƒå°æ¯”çŸ©é™£

| è©•ä¼°ç¶­åº¦       | AI å·¥å…· Hooks         | å‚³çµ± Git Hooks        | ç¾ä»£ Git Hooks (Husky) |
| -------------- | --------------------- | --------------------- | ---------------------- |
| **åœ˜éšŠå”ä½œ**   | âš ï¸ å€‹äººé…ç½®ç‚ºä¸»       | âŒ éœ€è¦æ‰‹å‹•åŒæ­¥       | âœ… è‡ªå‹•ç‰ˆæœ¬æ§åˆ¶        |
| **å­¸ç¿’æˆæœ¬**   | ä¸­ç­‰ (éœ€äº†è§£ AI å·¥å…·) | ä½ (Shell æŒ‡ä»¤ç¢¼åŸºç¤) | ä¸­ç­‰ (Node.js ç”Ÿæ…‹)    |
| **ç¶­è­·é›£åº¦**   | ä¸­ç­‰                  | é«˜ (æ˜“è¢«å¿½ç•¥)         | ä½ (è‡ªå‹•åŒ–ç®¡ç†)        |
| **æ•ˆèƒ½å½±éŸ¿**   | ä½ (åƒ… AI æ“ä½œæ™‚)     | ä½ (Shell åŸç”Ÿ)       | ä¸­ç­‰ (Node.js å•Ÿå‹•)    |
| **ç”Ÿæ…‹æ•´åˆ**   | ç‰¹å®š AI å·¥å…·          | åŸºç¤ Shell            | è±å¯Œçš„ç¾ä»£å·¥å…·éˆ       |
| **CI/CD æ”¯æ´** | æœ‰é™                  | éœ€è¦é¡å¤–é…ç½®          | å„ªç§€ (åŸç”Ÿæ”¯æ´)        |
| **è·¨å¹³å°æ€§**   | ä¾è³´ AI å·¥å…·          | å„ªç§€                  | å„ªç§€ (Node.js)         |
| **æ“´å……æ€§**     | ä¸­ç­‰                  | ä½                    | é«˜                     |

### å°ˆæ¡ˆè¦æ¨¡é¸æ“‡å»ºè­°

#### ğŸ‘¤ **å€‹äººå°ˆæ¡ˆ (1-2 äºº)**

```bash
# æ¨è–¦çµ„åˆï¼š
AI å·¥å…· Hooks + å‚³çµ± Git Hooks

# ç†ç”±ï¼š
- AI Hooks æå‡å€‹äººé–‹ç™¼æ•ˆç‡
- å‚³çµ± Git Hooks æ»¿è¶³åŸºæœ¬è‡ªå‹•åŒ–éœ€æ±‚
- ç„¡éœ€è¤‡é›œçš„åœ˜éšŠå”ä½œé…ç½®
```

#### ğŸ‘¥ **å°å‹åœ˜éšŠ (3-10 äºº)**

```bash
# æ¨è–¦çµ„åˆï¼š
AI å·¥å…· Hooks + ç¾ä»£ Git Hooks (Husky)

# ç†ç”±ï¼š
- Husky æä¾›åŸºæœ¬çš„åœ˜éšŠåŒæ­¥
- AI Hooks çµ±ä¸€é–‹ç™¼å·¥å…·ä½¿ç”¨
- å¹³è¡¡äº†è¤‡é›œåº¦å’ŒåŠŸèƒ½æ€§
```

#### ğŸ¢ **ä¸­å¤§å‹åœ˜éšŠ (10+ äºº)**

```bash
# æ¨è–¦çµ„åˆï¼š
ç¾ä»£ Git Hooks (Husky) + AI å·¥å…· Hooks

# ç†ç”±ï¼š
- Husky æä¾›ä¼æ¥­ç´šçš„å“è³ªä¿éšœ
- ç‰ˆæœ¬æ§åˆ¶ç¢ºä¿ä¸€è‡´æ€§
- æ”¯æ´è¤‡é›œçš„ CI/CD å·¥ä½œæµç¨‹
```

### ğŸ“ **æ ‡å‡† Git Hooks ä½ç½®**

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼ŒGit Hooks åº”è¯¥å­˜æ”¾åœ¨ï¼š

```
.git/hooks/
```

### ğŸ¤” **ä¸ºä»€ä¹ˆä½¿ç”¨ .husky/ è€Œä¸æ˜¯ .git/hooks/ï¼Ÿ**

è¿™æ˜¯ç°ä»£å¼€å‘çš„å…³é”®å·®å¼‚ï¼š

| ç‰¹æ€§               | `.git/hooks/` (åŸç”Ÿ)           | `.husky/` (ç°ä»£æ–¹æ¡ˆ)      |
| ------------------ | ------------------------------ | ------------------------- |
| **æ˜¯å¦å¯ç‰ˆæœ¬æ§åˆ¶** | âŒ ä¸å¯ä»¥ (`.git/` ä¸ä¼šè¢«æäº¤) | âœ… å¯ä»¥ (å¯æäº¤åˆ° Git)    |
| **å›¢é˜Ÿåä½œ**       | âŒ æ¯ä¸ªäººéœ€æ‰‹åŠ¨è®¾ç½®            | âœ… è‡ªåŠ¨åŒæ­¥ç»™æ‰€æœ‰å¼€å‘è€…   |
| **è·¨é¡¹ç›®å…±äº«**     | âŒ ä¸æ”¯æŒ                      | âœ… æ”¯æŒ                   |
| **Node.js é›†æˆ**   | âš ï¸ éœ€è¦æ‰‹åŠ¨é…ç½®                | âœ… åŸç”Ÿæ”¯æŒ npm scripts   |
| **ç»´æŠ¤æˆæœ¬**       | é«˜ (æ¯ä¸ªé¡¹ç›®å•ç‹¬é…ç½®)          | ä½ (ä¸€æ¬¡é…ç½®ï¼Œå…¨é¡¹ç›®é€šç”¨) |
| **CI/CD å…¼å®¹æ€§**   | âŒ éœ€è¦é¢å¤–é…ç½®                | âœ… åŸç”Ÿæ”¯æŒ               |

---

### ğŸ”„ **å·¥ä½œåŸç†å¯¹æ¯”**

#### ä¼ ç»Ÿæ–¹æ³• (`.git/hooks/pre-commit`)

```bash
# é—®é¢˜ï¼šè¿™ä¸ªæ–‡ä»¶åœ¨ .git/ ç›®å½•ä¸‹ï¼Œä¸èƒ½è¢« Git è¿½è¸ª
.git/hooks/pre-commit  âŒ æ— æ³•å…±äº«ç»™å›¢é˜Ÿ
```

#### Husky æ–¹æ³• (`.husky/pre-commit`)

```bash
# è§£å†³æ–¹æ¡ˆï¼šHusky ä¼šè‡ªåŠ¨å°†è¿™äº›è„šæœ¬"é“¾æ¥"åˆ° .git/hooks/
.husky/pre-commit  âœ… å¯ä»¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
    â†“
Husky å®‰è£…æ—¶è‡ªåŠ¨åˆ›å»ºè½¯é“¾æ¥
    â†“
.git/hooks/pre-commit  â† å®é™…æ‰§è¡Œçš„ä½ç½®
```

---

### ğŸ“‹ **Git Hooks ç±»å‹è¯¦è§£ï¼ˆä¸­æ–‡è¯´æ˜ï¼‰**

#### **å®¢æˆ·ç«¯ Hooks**

##### 1ï¸âƒ£ **æäº¤å·¥ä½œæµ Hooks**

- **`pre-commit`**
  - **æ—¶æœº**ï¼šåœ¨ä½ è¾“å…¥æäº¤ä¿¡æ¯ä¹‹å‰
  - **ç”¨é€”**ï¼šæ£€æŸ¥ä»£ç é£æ ¼ã€è¿è¡Œæµ‹è¯•ã€æ£€æŸ¥ç©ºç™½å­—ç¬¦
  - **é€€å‡ºéé›¶**ï¼šä¸­æ­¢æäº¤

- **`prepare-commit-msg`**
  - **æ—¶æœº**ï¼šç¼–è¾‘å™¨å¯åŠ¨å‰ï¼Œé»˜è®¤ä¿¡æ¯åˆ›å»ºå
  - **ç”¨é€”**ï¼šè‡ªåŠ¨æ’å…¥æäº¤æ¨¡æ¿ä¿¡æ¯

- **`commit-msg`**
  - **æ—¶æœº**ï¼šæäº¤ä¿¡æ¯å†™å…¥å
  - **ç”¨é€”**ï¼šéªŒè¯æäº¤ä¿¡æ¯æ ¼å¼ï¼ˆå¦‚ï¼šå¿…é¡»åŒ…å« Issue å·ï¼‰

- **`post-commit`**
  - **æ—¶æœº**ï¼šæäº¤å®Œæˆå
  - **ç”¨é€”**ï¼šå‘é€é€šçŸ¥ã€è§¦å‘ CI/CD

##### 2ï¸âƒ£ **å…¶ä»–å®¢æˆ·ç«¯ Hooks**

- **`pre-push`**ï¼šæ¨é€å‰è¿è¡Œï¼ˆå¯ç”¨äºè¿è¡Œå®Œæ•´æµ‹è¯•ï¼‰
- **`post-checkout`**ï¼šåˆ‡æ¢åˆ†æ”¯åè¿è¡Œ
- **`post-merge`**ï¼šåˆå¹¶å®Œæˆåè¿è¡Œ

#### **æœåŠ¡å™¨ç«¯ Hooks**

- **`pre-receive`**ï¼šæ¥æ”¶æ¨é€å‰ï¼ˆå¯æ‹’ç»æ¨é€ï¼‰
- **`update`**ï¼šæ¯ä¸ªåˆ†æ”¯æ›´æ–°æ—¶è¿è¡Œ
- **`post-receive`**ï¼šæ¨é€å®Œæˆåï¼ˆå‘é€é€šçŸ¥ã€è§¦å‘éƒ¨ç½²ï¼‰

---

### ğŸ¯ **ä½¿ç”¨æ—¶æœºå¯¹æ¯”**

#### ä¼ ç»Ÿ Git Hooks ä½¿ç”¨æ—¶æœº

```bash
# é€‚ç”¨äºï¼š
# - ä¸ªäººé¡¹ç›®ï¼Œæ— éœ€å›¢é˜Ÿå…±äº«
# - ç®€å•çš„ shell è„šæœ¬éªŒè¯
# - ä¸ä½¿ç”¨ Node.js/npm çš„é¡¹ç›®
# - å¯¹ç‰ˆæœ¬æ§åˆ¶è¦æ±‚ä¸é«˜çš„åœºæ™¯
```

#### Husky ä½¿ç”¨æ—¶æœº

```bash
# é€‚ç”¨äºï¼š
# - å›¢é˜Ÿåä½œé¡¹ç›®
# - ä½¿ç”¨ç°ä»£å‰ç«¯å·¥å…·é“¾ (ESLint, Prettier, TypeScript)
# - éœ€è¦ lint-staged ç­‰é«˜çº§åŠŸèƒ½çš„åœºæ™¯
# - å¸Œæœ›è‡ªåŠ¨åŒ– CI/CD é›†æˆçš„é¡¹ç›®
```

---

### ğŸ“Š **å®é™…åº”ç”¨å¯¹æ¯”**

#### **æ–¹æ¡ˆ 1ï¼šåŸç”Ÿ Git Hooks**

```bash
# æ¯ä¸ªå¼€å‘è€…éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ
cd /Users/jason66/Owner\ Real\ Estate\ Agent\ SaaS/.git/hooks
echo '#!/bin/sh
npm run lint' > pre-commit
chmod +x pre-commit
```

**é—®é¢˜**ï¼šå›¢é˜Ÿæˆå‘˜æ— æ³•è‡ªåŠ¨è·å¾—è¿™äº›é…ç½®ï¼

#### **æ–¹æ¡ˆ 2ï¼šHusky (æ¨èæ–¹æ¡ˆ)**

```bash
# è‡ªåŠ¨åŒ–å®‰è£…
npm install husky --save-dev
npx husky install

# åˆ›å»ºå¯ç‰ˆæœ¬æ§åˆ¶çš„ Hook
npx husky add .husky/pre-commit "npm run lint"
```

**ä¼˜åŠ¿**ï¼š

1. âœ… æäº¤åˆ° Gitï¼Œå›¢é˜Ÿè‡ªåŠ¨åŒæ­¥
2. âœ… `npm install` åè‡ªåŠ¨æ¿€æ´»
3. âœ… æ”¯æŒç°ä»£å·¥å…·é“¾ï¼ˆlint-stagedã€TypeScript ç­‰ï¼‰

---

### âš™ï¸ **é…ç½®å¤æ‚åº¦å¯¹æ¯”**

| é…ç½®é¡¹         | ä¼ ç»Ÿ Git Hooks       | Husky                                 |
| -------------- | -------------------- | ------------------------------------- |
| **å®‰è£…æ­¥éª¤**   | æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶ + chmod | npm install + npx husky install       |
| **è„šæœ¬ç¼–å†™**   | Shell è„šæœ¬           | æ”¯æŒå¤šç§è¯­è¨€ (Shell, Node.js, Python) |
| **è°ƒè¯•éš¾åº¦**   | ä¸­ç­‰ (éœ€æ‰‹åŠ¨æµ‹è¯•)    | ä½ (æä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯)                 |
| **è·¨å¹³å°å…¼å®¹** | ä¾èµ– Shell ç¯å¢ƒ      | ä¼˜ç§€ (Node.js è·¨å¹³å°)                 |
| **é›†æˆå·¥å…·**   | æœ‰é™                 | ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿ                        |

---

### ğŸš€ **æ€§èƒ½ä¸æ•ˆç‡å¯¹æ¯”**

#### ä¼ ç»Ÿ Git Hooks

- **å¯åŠ¨æ—¶é—´**: å¿« (ç›´æ¥æ‰§è¡Œ Shell è„šæœ¬)
- **ä¾èµ–ç®¡ç†**: æ—  (çº¯ Shell)
- **æ‰©å±•æ€§**: ä½ (éš¾ä»¥é›†æˆå¤æ‚å·¥å…·)
- **é”™è¯¯å¤„ç†**: åŸºç¡€ (Shell exit codes)

#### Husky

- **å¯åŠ¨æ—¶é—´**: ç¨æ…¢ (Node.js å¯åŠ¨å¼€é”€)
- **ä¾èµ–ç®¡ç†**: ä¼˜ç§€ (npm/yarn ç”Ÿæ€)
- **æ‰©å±•æ€§**: é«˜ (å¯é›†æˆä»»ä½• Node.js å·¥å…·)
- **é”™è¯¯å¤„ç†**: å…ˆè¿› (è¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•)

---

### ğŸ‘¥ **å›¢é˜Ÿåä½œå¯¹æ¯”**

#### ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜

```
æ–°å›¢é˜Ÿæˆå‘˜åŠ å…¥
    â†“
å¿˜è®°é…ç½® Git Hooks
    â†“
æäº¤äº†ä¸ç¬¦åˆè¦ç¯„çš„ä»£ç¢¼
    â†“
CI/CD å¤±æ•—
    â†“
æµªè²»æ™‚é–“ä¿®å¾©
```

#### Husky çš„è§£æ±ºæ–¹æ¡ˆ

```
æ–°åœ˜éšŠæˆå“¡åŠ å…¥
    â†“
é‹è¡Œ npm install
    â†“
Husky è‡ªå‹•å•Ÿç”¨æ‰€æœ‰ Hooks
    â†“
ä»£ç¢¼è³ªé‡è‡ªå‹•ä¿éšœ
    â†“
å°ˆæ³¨é–‹ç™¼åŠŸèƒ½
```

---

## ï¿½ğŸ”„ å·¥ä½œæµç¨‹å°æ¯”

### Claude Code Hook æµç¨‹

```
é–‹ç™¼è€…è«‹æ±‚ Claude Code åŸ·è¡Œå‘½ä»¤
        â†“
Claude Code æº–å‚™åŸ·è¡Œ Bash å·¥å…·
        â†“
PreToolUse Hook è§¸ç™¼
        â†“
é©—è­‰å‘½ä»¤æ˜¯å¦ç¬¦åˆè¦ç¯„
        â†“
ä¸ç¬¦åˆ â†’ é¡¯ç¤ºè­¦å‘Šä¸¦é˜»æ­¢åŸ·è¡Œ
ç¬¦åˆ â†’ å…è¨±åŸ·è¡Œ
```

### Git Hook æµç¨‹

```
é–‹ç™¼è€…åŸ·è¡Œ git commit
        â†“
Git æº–å‚™å‰µå»ºæäº¤
        â†“
pre-commit Hook è§¸ç™¼
        â†“
é‹è¡Œä»£ç¢¼æª¢æŸ¥å’Œå®‰å…¨é©—è­‰
        â†“
å¤±æ•— â†’ ä¸­æ­¢æäº¤
æˆåŠŸ â†’ ç¹¼çºŒæäº¤æµç¨‹
```

---

## ğŸ¯ å¯¦éš›æ‡‰ç”¨å ´æ™¯

### Claude Code Hook é€‚ç”¨åœºæ™¯

- **ä»£ç æœç´¢ä¼˜åŒ–**: å¼ºåˆ¶ä½¿ç”¨ `ripgrep` è€Œä¸æ˜¯ `grep`
- **å‘½ä»¤è§„èŒƒç»Ÿä¸€**: ç¡®ä¿ AI ä½¿ç”¨æ ‡å‡†åŒ–çš„å‘½ä»¤æ ¼å¼
- **æ€§èƒ½ä¼˜åŒ–**: è‡ªåŠ¨æ¨èæ›´é«˜æ•ˆçš„å·¥å…·é“¾

### Git Hook é€‚ç”¨åœºæ™¯

- **ä»£ç è´¨é‡ä¿è¯**: ESLintã€Prettier è‡ªåŠ¨ä¿®å¤
- **å®‰å…¨æ£€æŸ¥**: é˜²æ­¢ API keys è¢«æ„å¤–æäº¤
- **æµ‹è¯•éªŒè¯**: æäº¤å‰è¿è¡Œå•å…ƒæµ‹è¯•
- **å›¢é˜Ÿè§„èŒƒ**: ç»Ÿä¸€ä»£ç é£æ ¼å’Œæäº¤ä¿¡æ¯æ ¼å¼

---

## âš™ï¸ é…ç½®å»ºè­°

### å°æ–¼å€‹äººå°ˆæ¡ˆ

- **Claude Code Hook**: æ¨è–¦ä½¿ç”¨ï¼Œæå‡ AI é–‹ç™¼æ•ˆç‡
- **Git Hook**: å¯é¸ï¼Œè¦–å°ˆæ¡ˆè¤‡é›œåº¦è€Œå®š

### å°æ–¼åœ˜éšŠå°ˆæ¡ˆ

- **Claude Code Hook**: å€‹äººé…ç½®ï¼Œä¸å½±éŸ¿åœ˜éšŠ
- **Git Hook**: å¼·çƒˆæ¨è–¦ï¼Œä½¿ç”¨ Husky å¯¦ç¾è‡ªå‹•åŒ–

### ç•¶å‰å°ˆæ¡ˆé…ç½®

```bash
# å…¨å±€ Claude Hook (å€‹äºº)
~/.config/claude-code/config.json

# å°ˆæ¡ˆ Git Hooks (åœ˜éšŠå…±äº«)
.husky/pre-commit
.husky/pre-push
.lintstagedrc.json
```

---

## ğŸ”§ å®‰è£èˆ‡ç¶­è­·

### Claude Code Hook ç»´æŠ¤

```bash
# æ›´æ–°è…³æœ¬
vim ~/.config/claude-code/hooks/bash_command_validator.py

# æ¸¬è©¦é…ç½®
claude-code --help  # é©—è­‰é…ç½®è¼‰å…¥
```

### Git Hook ç»´æŠ¤

```bash
# å®‰è£ Husky
npm install husky --save-dev
npx husky install

# æ·»åŠ æ–° Hook
npx husky add .husky/pre-commit "npm run test"

# åœ˜éšŠåŒæ­¥
git add .husky/
git commit -m "feat: add git hooks configuration"
```

---

## ğŸ“ ç¸½çµ

### ğŸ¯ **ä¸‰ç¨® Hooks çš„å®šä½èˆ‡é¸æ“‡**

#### **Claude Code Hook (å…¨å±€ AI å„ªåŒ–)**

- **é©ç”¨å ´æ™¯**: å€‹äººé–‹ç™¼ç’°å¢ƒå„ªåŒ–
- **å„ªå‹¢**: æå‡ AI å·¥å…·åŸ·è¡Œæ•ˆç‡
- **å»ºè­°**: åœ¨æœ‰ AI è¼”åŠ©é–‹ç™¼éœ€æ±‚æ™‚é…ç½®

#### **å‚³çµ± Git Hooks (ç°¡å–®å°ˆæ¡ˆ)**

- **é©ç”¨å ´æ™¯**: å€‹äººå°ˆæ¡ˆæˆ–å°å‹åœ˜éšŠ
- **å„ªå‹¢**: è¼•é‡ç´šï¼Œç„¡é¡å¤–ä¾è³´
- **å»ºè­°**: ç•¶å°ˆæ¡ˆç„¡éœ€è¤‡é›œå·¥å…·éˆæ™‚ä½¿ç”¨

#### **Husky Git Hooks (ç¾ä»£åœ˜éšŠå°ˆæ¡ˆ)**

- **é©ç”¨å ´æ™¯**: ä¸­å¤§å‹åœ˜éšŠå”ä½œå°ˆæ¡ˆ
- **å„ªå‹¢**: å¯ç‰ˆæœ¬æ§åˆ¶ï¼Œè‡ªå‹•åŒ–ç®¡ç†ï¼Œè±å¯Œçš„ç”Ÿæ…‹
- **å»ºè­°**: **å¼·çƒˆæ¨è–¦**ç”¨æ–¼ç¾ä»£å‰ç«¯/å…¨æ£§å°ˆæ¡ˆ

---

---

## ğŸ”§ å¯¦éš›é…ç½®æ¡ˆä¾‹

### å ´æ™¯ 1: å‰ç«¯ React å°ˆæ¡ˆ

```bash
# ä½¿ç”¨ Husky + lint-staged + ESLint + Prettier
npm install husky lint-staged eslint prettier --save-dev
npx husky install
npx husky add .husky/pre-commit "npx lint-staged"
```

### å ´æ™¯ 2: Python è³‡æ–™ç§‘å­¸å°ˆæ¡ˆ

```bash
# ä½¿ç”¨å‚³çµ± Git Hooks + black + flake8
# .git/hooks/pre-commit
#!/bin/sh
black --check .
flake8 .
```

### å ´æ™¯ 3: Claude Code AI è¼”åŠ©é–‹ç™¼ç’°å¢ƒ

```json
// ~/.config/claude-code/config.json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.config/claude-code/hooks/bash_command_validator.py"
          }
        ]
      }
    ]
  }
}
```

**é…ç½®ç‰¹é»**:

- å…¨åŸŸç”Ÿæ•ˆï¼Œé©ç”¨æ‰€æœ‰å°ˆæ¡ˆ
- è‡ªå‹•é©—è­‰ Bash å‘½ä»¤å“è³ª
- å³æ™‚æä¾›æ•ˆèƒ½å„ªåŒ–å»ºè­°
- ç„¡éœ€å°ˆæ¡ˆç´šé…ç½®ï¼Œåœ˜éšŠå…±äº«

---

## ğŸš€ æœ€ä½³å¯¦å‹™å»ºè­°

### æ¼¸é€²å¼æ¡ç”¨ç­–ç•¥

```
å¾ç°¡å–®é–‹å§‹
    â†“
è©•ä¼°æ•ˆæœ
    â†“
é€æ­¥æ“´å±•
    â†“
å»ºç«‹æ¨™æº–
```

### å“è³ªä¿éšœæ¸…å–®

- [ ] åœ˜éšŠæˆå“¡éƒ½èƒ½æ­£å¸¸ä½¿ç”¨
- [ ] CI/CD æµæ°´ç·šç›¸å®¹
- [ ] ä¸æœƒé¡¯è‘—å½±éŸ¿é–‹ç™¼æ•ˆç‡
- [ ] æœ‰å®Œå–„çš„éŒ¯èª¤è™•ç†
- [ ] æ–‡ä»¶é½Šå…¨ï¼Œæ˜“æ–¼ç¶­è­·

### æ•ˆèƒ½æœ€ä½³åŒ–å»ºè­°

- é¸æ“‡åˆé©çš„å·¥å…·çµ„åˆ
- åˆç†è¨­å®šé€¾æ™‚æ™‚é–“
- ä½¿ç”¨å¿«å–æ©Ÿåˆ¶
- å®šæœŸå¯©æŸ¥å’Œæ¸…ç†ç„¡æ•ˆ hooks

---

## ğŸ”„ é·ç§»èˆ‡å‡ç´šæŒ‡å—

### å¾å‚³çµ± Git Hooks é·ç§»åˆ° Husky

```bash
# 1. è©•ä¼°ç¾æœ‰ hooks
find .git/hooks -type f -executable

# 2. å®‰è£ Husky
npm install husky --save-dev

# 3. é·ç§»é…ç½®
npx husky install
# æ‰‹å‹•é·ç§»æ¯å€‹ hook æŒ‡ä»¤ç¢¼

# 4. æ¸¬è©¦é©—è­‰
git commit -m "test"  # é©—è­‰ hooks æ­£å¸¸å·¥ä½œ
```

### å¼•å…¥ AI å·¥å…· Hooks

```bash
# 1. è©•ä¼° AI å·¥å…·ä½¿ç”¨é »ç‡
# 2. è­˜åˆ¥å¸¸ç”¨å‘½ä»¤æ¨¡å¼
# 3. é…ç½®åˆé©çš„é©—è­‰è¦å‰‡
# 4. åœ˜éšŠè¨“ç·´å’Œæ–‡ä»¶æ›´æ–°

# Claude Code å…·é«”é…ç½®æ­¥é©Ÿï¼š
# 1. å»ºç«‹é…ç½®ç›®éŒ„
mkdir -p ~/.config/claude-code/hooks

# 2. å»ºç«‹é©—è­‰æŒ‡ä»¤ç¢¼
# è¤‡è£½ bash_command_validator.py åˆ° ~/.config/claude-code/hooks/

# 3. å»ºç«‹é…ç½®æ–‡ä»¶
# å»ºç«‹ ~/.config/claude-code/config.json

# 4. æ¸¬è©¦é…ç½®
claude-code --help  # é©—è­‰é…ç½®è¼‰å…¥
```

---

## ğŸ“ ç¸½çµ

### è»Ÿé«”å·¥ç¨‹å¸«çš„æ±ºç­–æ¡†æ¶

é¸æ“‡åˆé©çš„ Hook æ–¹æ¡ˆéœ€è¦è€ƒæ…®ï¼š

1. **å°ˆæ¡ˆéšæ®µ**: æ–°å°ˆæ¡ˆ vs éºç•™å°ˆæ¡ˆ
2. **åœ˜éšŠæˆç†Ÿåº¦**: å€‹äººé–‹ç™¼è€… vs ä¼æ¥­åœ˜éšŠ
3. **æŠ€è¡“æ£§**: å‚³çµ±æŠ€è¡“æ£§ vs ç¾ä»£å·¥å…·éˆ
4. **å“è³ªè¦æ±‚**: åŸºç¤æª¢æŸ¥ vs å…¨é¢è‡ªå‹•åŒ–
5. **ç¶­è­·è³‡æº**: æ™‚é–“å’ŒäººåŠ›æŠ•å…¥

### æœªä¾†è¶¨å‹¢

- AI å·¥å…· Hooks å°‡è®Šå¾—æ›´åŠ æ™ºæ…§
- Git Hooks ç”Ÿæ…‹ç³»çµ±æŒçºŒç™¼å±•
- é›²åŸç”Ÿ CI/CD èˆ‡æœ¬åœ° hooks çš„èåˆ
- å®‰å…¨æ€§æª¢æŸ¥çš„è‡ªå‹•åŒ–å¢å¼·

---

_æœ¬æ–‡æª”é¢å‘æ‰€æœ‰è»Ÿé«”å·¥ç¨‹å¸«ï¼Œæä¾›å¯¦ç”¨çš„ Hook è¨­å®šæŒ‡å°_  
_æœ€å¾Œæ›´æ–°: 2025-01-13_  
_é©ç”¨å ´æ™¯: ç¾ä»£è»Ÿé«”é–‹ç™¼ç’°å¢ƒ_

---

## ğŸ  æœ¬å°ˆæ¡ˆ Hook é…ç½®

### å°ˆæ¡ˆæ¦‚è¿°

**Owner Real Estate Agent SaaS** æ˜¯ä¸€å€‹æˆ¿åœ°ç”¢ä»£ç† SaaS å¹³å°ï¼Œä½¿ç”¨ä»¥ä¸‹æŠ€è¡“æ£§ï¼š

- **å‰ç«¯**: Next.js + TypeScript
- **å¾Œç«¯**: Supabase
- **AI è¼”åŠ©**: Claude Code

### å·²é…ç½®çš„ Hooks

#### 1. Pre-commit Hook

**ä½ç½®**: `.husky/pre-commit`

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."
npx lint-staged
npx tsc --noEmit
echo "âœ… Pre-commit checks passed!"
```

**åŠŸèƒ½**:

- åŸ·è¡Œ lint-staged å°æš«å­˜æª”æ¡ˆé€²è¡Œ ESLint å’Œ Prettier æª¢æŸ¥
- åŸ·è¡Œ TypeScript å‹åˆ¥æª¢æŸ¥

#### 2. Commit-msg Hook

**ä½ç½®**: `.husky/commit-msg`

**åŠŸèƒ½**:

- é©—è­‰æäº¤è¨Šæ¯æ ¼å¼ç¬¦åˆ Conventional Commits è¦ç¯„
- æ”¯æ´çš„ Type: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`, `perf`, `ci`, `build`, `revert`

#### 3. Pre-push Hook

**ä½ç½®**: `.husky/pre-push`

**åŠŸèƒ½**:

- æ¨é€å‰åŸ·è¡Œæ¸¬è©¦
- åŸ·è¡Œå»ºç½®æª¢æŸ¥ç¢ºä¿ç¨‹å¼ç¢¼å¯æ­£å¸¸ç·¨è­¯

### å¿«é€Ÿé–‹å§‹

```bash
# 1. å®‰è£ä¾è³´
npm install

# 2. Husky æœƒè‡ªå‹•åˆå§‹åŒ– (é€é prepare script)

# 3. é©—è­‰ hooks æ˜¯å¦æ­£å¸¸é‹ä½œ
git add .
git commit -m "test: verify hooks are working"
```

### å¸¸è¦‹å•é¡Œæ’é™¤

#### Hook æœªåŸ·è¡Œ

```bash
# é‡æ–°åˆå§‹åŒ– Husky
npx husky install

# ç¢ºä¿ hook æª”æ¡ˆæœ‰åŸ·è¡Œæ¬Šé™
chmod +x .husky/pre-commit
chmod +x .husky/commit-msg
chmod +x .husky/pre-push
```

#### è·³é Hook (ç·Šæ€¥æƒ…æ³)

```bash
# è·³é pre-commit å’Œ commit-msg
git commit --no-verify -m "ç·Šæ€¥ä¿®å¾©"

# è·³é pre-push
git push --no-verify
```

---

_æœ¬æ–‡æª”é¢å‘æ‰€æœ‰è»Ÿé«”å·¥ç¨‹å¸«ï¼Œæä¾›å¯¦ç”¨çš„ Hook è¨­å®šæŒ‡å°_  
_æœ€å¾Œæ›´æ–°: 2025-01-13_  
_é©ç”¨å ´æ™¯: ç¾ä»£è»Ÿé«”é–‹ç™¼ç’°å¢ƒ_
